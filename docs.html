<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WindMar Documentation - Technical Reference</title>
    <link rel="stylesheet" href="assets/css/docs.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"></script>
</head>
<body>

<!-- Header -->
<header class="docs-header">
    <div class="docs-header-content">
        <a href="docs.html" class="docs-logo">
            <i class="fas fa-ship"></i>
            <span>WindMar</span>
        </a>
        <nav>
            <ul class="docs-nav">
                <li><a href="docs.html" class="active">Documentation</a></li>
                <li class="docs-nav-dropdown">
                    <a href="#">Technical Articles <i class="fas fa-caret-down"></i></a>
                    <ul class="docs-nav-dropdown-menu">
                        <li><a href="weather-fields.html">Weather Fields</a></li>
                        <li><a href="data-pipeline.html">Data Pipeline</a></li>
                        <li><a href="hydrodynamics.html">Hydrodynamics &amp; RAO</a></li>
                        <li><a href="astar-pathfinding.html">A* Pathfinding</a></li>
                        <li><a href="route-optimization-engines.html">Optimization Engines</a></li>
                        <li><a href="weather-data.html">Weather Acquisition</a></li>
                        <li><a href="monte-carlo.html">Monte Carlo</a></li>
                        <li><a href="open-problems.html">Open Problems</a></li>
                    </ul>
                </li>
                <li><a href="https://github.com/windmar-nav/windmar" target="_blank"><i class="fab fa-github"></i> GitHub</a></li>
                <li><span class="demo-nav-link" style="opacity: 0.5; cursor: default;"><i class="fas fa-clock"></i> Demo Coming in March</span></li>
            </ul>
        </nav>
        <a href="project.html" class="back-to-main"><i class="fas fa-arrow-left"></i> Back to Main Site</a>
    </div>
</header>

<!-- Main Layout -->
<div class="docs-container">

    <!-- Sidebar -->
    <aside class="docs-sidebar">

        <div class="sidebar-section">
            <div class="sidebar-title">Getting Started</div>
            <ul class="sidebar-menu">
                <li><a href="#overview"><i class="fas fa-home"></i> Overview</a></li>
                <li><a href="#architecture"><i class="fas fa-sitemap"></i> Architecture</a></li>
                <li><a href="#installation"><i class="fas fa-download"></i> Installation</a></li>
                <li><a href="#tech-stack"><i class="fas fa-layer-group"></i> Tech Stack</a></li>
            </ul>
        </div>

        <div class="sidebar-section">
            <div class="sidebar-title">Physical Models</div>
            <ul class="sidebar-menu">
                <li><a href="#calm-water"><i class="fas fa-water"></i> Calm Water Resistance</a></li>
                <li><a href="#wind-resistance"><i class="fas fa-wind"></i> Wind Resistance</a></li>
                <li><a href="#wave-resistance"><i class="fas fa-wave-square"></i> Wave Resistance</a></li>
                <li><a href="#sfoc-curve"><i class="fas fa-gas-pump"></i> SFOC Curve</a></li>
                <li><a href="#propulsion-chain"><i class="fas fa-cog"></i> Propulsion Chain</a></li>
            </ul>
        </div>

        <div class="sidebar-section">
            <div class="sidebar-title">Seakeeping</div>
            <ul class="sidebar-menu">
                <li><a href="#ship-motions"><i class="fas fa-arrows-alt"></i> Ship Motions</a></li>
                <li><a href="#safety-criteria"><i class="fas fa-shield-alt"></i> Safety Criteria</a></li>
                <li><a href="#slamming-roll"><i class="fas fa-exclamation-triangle"></i> Slamming &amp; Roll</a></li>
            </ul>
        </div>

        <div class="sidebar-section">
            <div class="sidebar-title">Route Optimization</div>
            <ul class="sidebar-menu">
                <li><a href="#astar-algorithm"><i class="fas fa-route"></i> A* Algorithm</a></li>
                <li><a href="#variable-speed"><i class="fas fa-tachometer-alt"></i> Variable Speed</a></li>
                <li><a href="#safety-constraints"><i class="fas fa-ban"></i> Safety Constraints</a></li>
                <li><a href="#gshhs-coastline"><i class="fas fa-globe-americas"></i> GSHHS Coastline</a></li>
                <li><a href="#variable-resolution"><i class="fas fa-th"></i> Variable Resolution</a></li>
                <li><a href="#strait-shortcuts"><i class="fas fa-draw-polygon"></i> Strait Shortcuts</a></li>
                <li><a href="#pareto-front"><i class="fas fa-chart-area"></i> Pareto Front</a></li>
            </ul>
        </div>

        <div class="sidebar-section">
            <div class="sidebar-title">Compliance</div>
            <ul class="sidebar-menu">
                <li><a href="#cii-rating"><i class="fas fa-certificate"></i> IMO CII Rating</a></li>
                <li><a href="#fueleu-maritime"><i class="fas fa-leaf"></i> FuelEU Maritime</a></li>
                <li><a href="#voyage-reporting"><i class="fas fa-file-alt"></i> Voyage Reporting</a></li>
                <li><a href="#charter-party"><i class="fas fa-handshake"></i> Charter Party Clauses</a></li>
                <li><a href="#regulatory-zones"><i class="fas fa-map-marked-alt"></i> Regulatory Zones</a></li>
            </ul>
        </div>

        <div class="sidebar-section">
            <div class="sidebar-title">Weather Data</div>
            <ul class="sidebar-menu">
                <li><a href="weather-data.html"><i class="fas fa-cloud-sun-rain"></i> Weather Data Acquisition</a></li>
                <li><a href="#weather-database"><i class="fas fa-database"></i> Weather Database</a></li>
                <li><a href="#forecast-timeline"><i class="fas fa-clock"></i> Forecast Timeline</a></li>
            </ul>
        </div>

        <div class="sidebar-section">
            <div class="sidebar-title">Monte Carlo</div>
            <ul class="sidebar-menu">
                <li><a href="#monte-carlo"><i class="fas fa-dice"></i> Simulation Engine</a></li>
                <li><a href="monte-carlo.html"><i class="fas fa-book"></i> Technical Article</a></li>
            </ul>
        </div>

        <div class="sidebar-section">
            <div class="sidebar-title">API Reference</div>
            <ul class="sidebar-menu">
                <li><a href="#weather-api"><i class="fas fa-cloud-sun"></i> Weather API</a></li>
                <li><a href="#route-api"><i class="fas fa-directions"></i> Route API</a></li>
                <li><a href="#vessel-api"><i class="fas fa-anchor"></i> Vessel API</a></li>
                <li><a href="#performance-predictor"><i class="fas fa-tachometer-alt"></i> Performance Predictor</a></li>
                <li><a href="#engine-log-api"><i class="fas fa-clipboard-list"></i> Engine Log API</a></li>
            </ul>
        </div>

        <div class="sidebar-section">
            <div class="sidebar-title">Validation</div>
            <ul class="sidebar-menu">
                <li><a href="#model-validation"><i class="fas fa-check-circle"></i> Model Validation</a></li>
                <li><a href="#calibration"><i class="fas fa-sliders-h"></i> Calibration</a></li>
            </ul>
        </div>

        <div class="sidebar-section">
            <div class="sidebar-title">Gallery</div>
            <ul class="sidebar-menu">
                <li><a href="#gallery"><i class="fas fa-images"></i> Screenshots</a></li>
            </ul>
        </div>

        <div class="sidebar-section">
            <div class="sidebar-title">Technical Articles</div>
            <ul class="sidebar-menu">
                <li><a href="#technical-articles"><i class="fas fa-newspaper"></i> Article Index</a></li>
                <li><a href="weather-fields.html"><i class="fas fa-cloud-sun"></i> Weather Fields</a></li>
                <li><a href="data-pipeline.html"><i class="fas fa-database"></i> Data Pipeline</a></li>
                <li><a href="hydrodynamics.html"><i class="fas fa-water"></i> Hydrodynamics &amp; RAO</a></li>
                <li><a href="astar-pathfinding.html"><i class="fas fa-route"></i> A* Pathfinding</a></li>
                <li><a href="weather-data.html"><i class="fas fa-cloud-sun-rain"></i> Weather Acquisition</a></li>
                <li><a href="monte-carlo.html"><i class="fas fa-dice"></i> Monte Carlo</a></li>
                <li><a href="open-problems.html"><i class="fas fa-compass"></i> Open Problems</a></li>
            </ul>
        </div>

        <div class="sidebar-section">
            <div class="sidebar-title">Resources</div>
            <ul class="sidebar-menu">
                <li><a href="https://github.com/windmar-nav/windmar" target="_blank"><i class="fab fa-github"></i> GitHub</a></li>
            </ul>
        </div>

    </aside>

    <!-- Main Content -->
    <main class="docs-main">
        <div class="docs-content">

            <!-- ============================================================ -->
            <!-- OVERVIEW -->
            <!-- ============================================================ -->
            <section id="overview">
                <h1>WindMar Technical Documentation</h1>
                <p class="docs-subtitle">Weather routing &amp; performance analytics for merchant ships</p>

                <div class="alert" style="background: rgba(76, 175, 80, 0.08); border-left: 4px solid #4caf50; padding: 1rem 1.25rem; margin-bottom: 1.5rem;">
                    <strong><i class="fas fa-code-branch"></i> Development Log</strong>
                    <span style="display: inline-flex; align-items: center; gap: 0.4rem; background: rgba(76, 175, 80, 0.12); border: 1px solid rgba(76, 175, 80, 0.3); color: #66bb6a; padding: 0.15rem 0.65rem; border-radius: 1rem; font-size: 0.8rem; font-weight: 600; margin-left: 0.5rem; vertical-align: middle;">
                        <i class="fas fa-tag"></i> v0.1.3 &mdash; Last Stable
                    </span>
                    <table style="width: 100%; margin-top: 0.75rem; font-size: 0.9rem; border-collapse: collapse;">
                        <tr style="border-bottom: 1px solid rgba(255,255,255,0.06);">
                            <td style="padding: 0.35rem 0; white-space: nowrap; color: #9ca3af; width: 5rem;"><strong>v0.1.3</strong></td>
                            <td style="padding: 0.35rem 0.5rem; color: #6b7280; width: 6rem;">2026-02-27</td>
                            <td style="padding: 0.35rem 0;">Global weather coverage (7 layers, &plusmn;60&deg; lat, raster tiles &rarr; client-side canvas), WMO-standard wind barbs (calm circle, pennants, half/full barbs), calm wind zone coloring, double-buffered canvas rendering, gzip weather cache, ice land masking, SST coastline bleed fix, currents-over-land fix, settings page 2-column card layout, ~72K LOC</td>
                        </tr>
                        <tr style="border-bottom: 1px solid rgba(255,255,255,0.06);">
                            <td style="padding: 0.35rem 0; white-space: nowrap; color: #9ca3af; width: 5rem;"><strong>v0.1.2</strong></td>
                            <td style="padding: 0.35rem 0.5rem; color: #6b7280; width: 6rem;">2026-02-25</td>
                            <td style="padding: 0.35rem 0;">Dedicated Settings page with optimization engine configuration and educational content, per-leg variable speed optimization (fuel ~ speed&sup3;), session persistence (sessionStorage-backed React Context), demo mode hardening (locked viewport, hidden uploads, frozen weather), Dijkstra node budget reduction</td>
                        </tr>
                        <tr style="border-bottom: 1px solid rgba(255,255,255,0.06);">
                            <td style="padding: 0.35rem 0; white-space: nowrap; color: #9ca3af; width: 5rem;"><strong>v0.1.1</strong></td>
                            <td style="padding: 0.35rem 0.5rem; color: #6b7280; width: 6rem;">2026-02-24</td>
                            <td style="padding: 0.35rem 0;">Weather pipeline fixes: wind DB rebuild, SST black holes, wave OOM crash, weather debug endpoint, cache versioning, NaN sentinels, viewport margin &amp; latitude cap widening (&plusmn;55&deg; &rarr; &plusmn;60&deg;)</td>
                        </tr>
                        <tr style="border-bottom: 1px solid rgba(255,255,255,0.06);">
                            <td style="padding: 0.35rem 0; white-space: nowrap; color: #9ca3af; width: 5rem;"><strong>v0.1.0</strong></td>
                            <td style="padding: 0.35rem 0.5rem; color: #6b7280; width: 6rem;">2026-02-22</td>
                            <td style="padding: 0.35rem 0;">Commercial compliance (CII, FuelEU Maritime, charter party tools, voyage reporting) + production optimizer (GSHHS coastline, 9 strait shortcuts, Pareto front, course-change penalty, safety fallback, A*-primary with optional VISIR) + security hardening (pickle RCE fix, input bounds, CORS, rate limits, NaN/Inf sanitization), ~67K LOC, 734 tests</td>
                        </tr>
                        <tr style="border-bottom: 1px solid rgba(255,255,255,0.06);">
                            <td style="padding: 0.35rem 0; white-space: nowrap; color: #9ca3af; width: 5rem;"><strong>v0.0.9</strong></td>
                            <td style="padding: 0.35rem 0.5rem; color: #6b7280; width: 6rem;">2026-02-20</td>
                            <td style="padding: 0.35rem 0;">Modular architecture refactoring (6,922&rarr;281 LOC main.py, 9 domain routers, 37 Pydantic schemas), calibration improvements (ME-specific fuel, laden/ballast detection from ME load %, widened bounds), engine log deduplication, 426 tests passing</td>
                        </tr>
                        <tr style="border-bottom: 1px solid rgba(255,255,255,0.06);">
                            <td style="padding: 0.35rem 0; white-space: nowrap; color: #9ca3af; width: 5rem;"><strong>v0.0.8</strong></td>
                            <td style="padding: 0.35rem 0.5rem; color: #6b7280; width: 6rem;">2026-02-18</td>
                            <td style="padding: 0.35rem 0;">Vessel model upgrade (SFOC calibration fix, Kwon + STAWAVE-1 dual wave methods, bisection performance predictor), engine log analytics (CSV/Excel upload, 5 KPIs, 6 charts, calibration bridge), weather pipeline refactoring (user-triggered overlays, viewport-aware resync, deferred supersede), Dijkstra cost formula fix (safety on fuel only), hard avoidance limits (Hs &ge; 6&thinsp;m, wind &ge; 70&thinsp;kts), dashboard layout harmonization, 79 API endpoints</td>
                        </tr>
                        <tr style="border-bottom: 1px solid rgba(255,255,255,0.06);">
                            <td style="padding: 0.35rem 0; white-space: nowrap; color: #9ca3af; width: 5rem;"><strong>v0.0.7</strong></td>
                            <td style="padding: 0.35rem 0.5rem; color: #6b7280; width: 6rem;">2026-02-13</td>
                            <td style="padding: 0.35rem 0;">Two-mode architecture (Weather/Analysis), 7 weather layers with WMO color ramps, forecast timeline for all layers, analysis panel + detail page with per-waypoint passage plan, route save/load, current &amp; wave direction in results, Monte Carlo P10/P50/P90, vessel speed sync</td>
                        </tr>
                        <tr style="border-bottom: 1px solid rgba(255,255,255,0.06);">
                            <td style="padding: 0.35rem 0; white-space: nowrap; color: #9ca3af; width: 5rem;"><strong>v0.0.6</strong></td>
                            <td style="padding: 0.35rem 0.5rem; color: #6b7280; width: 6rem;">2026-02-10</td>
                            <td style="padding: 0.35rem 0;">ECDIS-style UI redesign, dual speed-strategy optimization (Same Speed / Match ETA), voyage baseline gating, wave crest rendering with polar diagram, GFS wind DB ingestion, turn-angle path smoothing</td>
                        </tr>
                        <tr style="border-bottom: 1px solid rgba(255,255,255,0.06);">
                            <td style="padding: 0.35rem 0; white-space: nowrap; color: #9ca3af; width: 5rem;"><strong>v0.0.5</strong></td>
                            <td style="padding: 0.35rem 0.5rem; color: #6b7280; width: 6rem;">2026-02-09</td>
                            <td style="padding: 0.35rem 0;">Weather DB architecture, temporal weather provisioning, Monte Carlo with correlated perturbations, CII compliance, PostgreSQL persistence</td>
                        </tr>
                        <tr style="border-bottom: 1px solid rgba(255,255,255,0.06);">
                            <td style="padding: 0.35rem 0; white-space: nowrap; color: #9ca3af;"><strong>v0.0.4</strong></td>
                            <td style="padding: 0.35rem 0.5rem; color: #6b7280;">2026-02-09</td>
                            <td style="padding: 0.35rem 0;">Frontend refactor, Monte Carlo simulation, grid weather provider</td>
                        </tr>
                        <tr style="border-bottom: 1px solid rgba(255,255,255,0.06);">
                            <td style="padding: 0.35rem 0; white-space: nowrap; color: #9ca3af;"><strong>v0.0.3</strong></td>
                            <td style="padding: 0.35rem 0.5rem; color: #6b7280;">2026-02-09</td>
                            <td style="padding: 0.35rem 0;">Data sources docs, credential setup, modernize pyproject.toml</td>
                        </tr>
                        <tr style="border-bottom: 1px solid rgba(255,255,255,0.06);">
                            <td style="padding: 0.35rem 0; white-space: nowrap; color: #9ca3af;"><strong>v0.0.2</strong></td>
                            <td style="padding: 0.35rem 0.5rem; color: #6b7280;">2026-02-08</td>
                            <td style="padding: 0.35rem 0;">GFS near-real-time wind data + 5-day forecast timeline</td>
                        </tr>
                        <tr>
                            <td style="padding: 0.35rem 0; white-space: nowrap; color: #9ca3af;"><strong>v0.0.1</strong></td>
                            <td style="padding: 0.35rem 0.5rem; color: #6b7280;">2026-02-08</td>
                            <td style="padding: 0.35rem 0;">Initial public release</td>
                        </tr>
                    </table>
                </div>

                <div class="alert info">
                    <strong><i class="fas fa-info-circle"></i> Maritime Operations Tool</strong><br>
                    WindMar is a physics-based vessel performance modeling system with weather-aware A* route optimization,
                    fuel consumption minimization, and IMO CII compliance tracking. It combines hydrodynamic resistance
                    calculations, seakeeping analysis, and real-time weather data to find the safest and most fuel-efficient
                    routes for merchant ships.
                </div>

                <h3>What is WindMar?</h3>
                <p>
                    WindMar is an end-to-end maritime route optimization platform designed for Medium Range (MR) product
                    tankers. It models the complete chain of vessel performance physics &mdash; from calm water resistance
                    through wind and wave added resistance, engine SFOC curves, and propulsion efficiency &mdash; to
                    predict fuel consumption under real weather conditions. The A* pathfinding algorithm then searches
                    for the route that minimizes total fuel consumption while respecting safety constraints and regulatory
                    zones. All calculations are grounded in established naval architecture methods: Holtrop-Mennen for
                    hull resistance, Blendermann for wind loads, Kwon for wave added resistance, and simplified strip
                    theory for seakeeping motions.
                </p>
                <p>
                    The system ingests near-real-time wind data from NOAA GFS (0.25&deg; resolution, via NOMADS),
                    wave, current, SST, swell, visibility, and ice data from Copernicus Marine Service (CMEMS), with ERA5 reanalysis as a
                    secondary wind fallback. Weather grids are pre-ingested into PostgreSQL on a 6-hourly cycle
                    (wind, waves, currents, ice), with on-demand prefetch for SST, visibility, and swell &mdash; enabling sub-second route calculations.
                    A forecast timeline (f000&ndash;f120, 3-hourly steps) supports all 7 weather layers with play/pause and scrubbing.
                    The interface uses a <strong>two-mode architecture</strong>: <em>Weather mode</em> presents a full-screen ECDIS-style
                    chart with 7 weather overlays and WMO-standard color ramps; <em>Analysis mode</em> displays a left panel (320px) for
                    route import, voyage calculation, optimization comparison (A* engine with optional VISIR Dijkstra), and
                    Monte Carlo simulation (P10/P50/P90). A dedicated analysis page shows a per-waypoint passage plan with
                    ETA, SOG, wind, waves, current speed/direction, fuel, and data source badges.
                    The system evaluates vessel motions (roll, pitch, vertical acceleration)
                    and enforces safety criteria that block or penalize dangerous sea states. It calculates
                    the IMO Carbon Intensity Indicator (CII) rating for the completed voyage, enabling operators to
                    assess regulatory compliance before departure.
                </p>

                <div class="screenshot-gallery" style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin: 2rem 0;">
                    <figure style="margin: 0;">
                        <a href="assets/img/screenshots/weather-wind.png" target="_blank">
                            <img src="assets/img/screenshots/weather-wind.png" alt="Wind forecast with particle animation and 5-day timeline" style="width: 100%; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 4px 12px rgba(0,0,0,0.3);">
                        </a>
                        <figcaption style="text-align: center; font-size: 0.85rem; color: #6b7280; margin-top: 0.5rem;">
                            <strong>Weather Mode</strong> — GFS wind particle animation with 5-day forecast timeline and WMO color ramp
                        </figcaption>
                    </figure>
                    <figure style="margin: 0;">
                        <a href="assets/img/screenshots/route-portugal-casquets.png" target="_blank">
                            <img src="assets/img/screenshots/route-portugal-casquets.png" alt="Route optimization with Pareto front and strait shortcuts" style="width: 100%; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 4px 12px rgba(0,0,0,0.3);">
                        </a>
                        <figcaption style="text-align: center; font-size: 0.85rem; color: #6b7280; margin-top: 0.5rem;">
                            <strong>Route Optimization</strong> — Weather-optimal routing with Pareto front and strait shortcuts
                        </figcaption>
                    </figure>
                </div>

                <div class="feature-grid">
                    <div class="feature-card">
                        <h4><i class="fas fa-water"></i> Vessel Performance</h4>
                        <ul>
                            <li>Holtrop-Mennen calm water resistance</li>
                            <li>Blendermann wind resistance model</li>
                            <li>Kwon wave added resistance formula</li>
                            <li>Engine SFOC curves with load-dependent correction</li>
                        </ul>
                    </div>
                    <div class="feature-card">
                        <h4><i class="fas fa-route"></i> Route Optimization</h4>
                        <ul>
                            <li>A* grid search with 9 strait shortcuts (primary engine)</li>
                            <li>3 safety-weight variants + Pareto front (fuel vs. time)</li>
                            <li>Course-change penalty, safety fallback routing</li>
                            <li>Per-waypoint passage plan with SOG profile</li>
                        </ul>
                    </div>
                    <div class="feature-card">
                        <h4><i class="fas fa-shield-alt"></i> Seakeeping Safety</h4>
                        <ul>
                            <li>Roll, pitch, and acceleration prediction</li>
                            <li>Slamming probability assessment</li>
                            <li>Parametric roll risk detection</li>
                            <li>Safety constraints in route optimization</li>
                        </ul>
                    </div>
                    <div class="feature-card">
                        <h4><i class="fas fa-cloud-sun"></i> Weather Integration</h4>
                        <ul>
                            <li>7 layers: wind, waves, currents, swell, SST, visibility, ice</li>
                            <li>Forecast timeline for all layers (5-day, 3h steps)</li>
                            <li>WMO-standard color ramps per field</li>
                            <li>6-hourly DB ingestion + on-demand prefetch</li>
                        </ul>
                    </div>
                    <div class="feature-card">
                        <h4><i class="fas fa-certificate"></i> IMO Compliance</h4>
                        <ul>
                            <li>CII rating calculator (A through E)</li>
                            <li>MEPC.339(76) reference values</li>
                            <li>Multi-year reduction factor projections</li>
                            <li>CO2 emission factors for multiple fuel types</li>
                        </ul>
                    </div>
                    <div class="feature-card">
                        <h4><i class="fas fa-sliders-h"></i> Vessel Calibration</h4>
                        <ul>
                            <li>Noon report processing from Excel</li>
                            <li>scipy.optimize parameter fitting</li>
                            <li>Per-component calibration factors</li>
                            <li>RMSE-based objective minimization</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- ============================================================ -->
            <!-- ARCHITECTURE -->
            <!-- ============================================================ -->
            <section id="architecture">
                <h2>Architecture</h2>

                <h3>Component Overview</h3>
                <p>
                    WindMar follows a layered architecture with a clear separation between the user-facing frontend,
                    the API backend, the physics-based optimization engine, and external data providers. Each component
                    runs as an independent service orchestrated via Docker Compose.
                </p>

                <table>
                    <thead>
                        <tr>
                            <th>Component</th>
                            <th>Technology</th>
                            <th>Responsibility</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Frontend</td>
                            <td>Next.js 15</td>
                            <td>Two-mode UI (Weather/Analysis), 7 weather map layers, route analysis panel, passage plan</td>
                        </tr>
                        <tr>
                            <td>Backend</td>
                            <td>FastAPI (Python)</td>
                            <td>REST API, request validation, orchestration of optimization engine</td>
                        </tr>
                        <tr>
                            <td>Optimization Engine</td>
                            <td>Python (NumPy, SciPy)</td>
                            <td>Physics models, A* pathfinding, speed optimization, seakeeping</td>
                        </tr>
                        <tr>
                            <td>Weather Provider</td>
                            <td>NOAA GFS / CMEMS / ERA5</td>
                            <td>GFS wind, CMEMS waves/currents/SST/swell/visibility/ice, ERA5 fallback, 5-day forecast</td>
                        </tr>
                        <tr>
                            <td>Database</td>
                            <td>PostgreSQL 16</td>
                            <td>Vessel specs, route history, calibration data, regulatory zones</td>
                        </tr>
                        <tr>
                            <td>Cache</td>
                            <td>Redis 7 / In-memory</td>
                            <td>Rate limiting, session state; weather fields cached in-memory</td>
                        </tr>
                    </tbody>
                </table>

                <h3>Data Flow</h3>
                <ol>
                    <li><strong>Route Definition</strong> &mdash; User defines departure, arrival, and waypoints on the map interface. Vessel condition (laden/ballast) and speed preferences are selected.</li>
                    <li><strong>Weather Fetch</strong> &mdash; Backend requests weather data from Copernicus for the route corridor. Wind, wave, and current fields are interpolated to the optimization grid.</li>
                    <li><strong>Performance Calculation</strong> &mdash; For each grid cell, the optimization engine computes total resistance (calm water + wind + waves), brake power, SFOC, and fuel consumption at candidate speeds.</li>
                    <li><strong>A* Pathfinding</strong> &mdash; The A* algorithm searches the grid using fuel consumption as the edge cost. Safety constraints block or penalize dangerous cells. Regulatory zones modify costs.</li>
                    <li><strong>Speed Optimization</strong> &mdash; Each leg of the optimal path is individually speed-optimized to minimize fuel per nautical mile given local weather conditions.</li>
                    <li><strong>Results</strong> &mdash; The optimized route, fuel estimate, ETA, leg-by-leg breakdown, seakeeping assessment, and CII rating are returned to the frontend for display.</li>
                </ol>

                <h3>Docker Services</h3>
                <pre><code>services:
  db:
    image: postgres:16-alpine
    ports: ["${DB_PORT:-5432}:5432"]

  redis:
    image: redis:7-alpine
    ports: ["${REDIS_PORT:-6379}:6379"]

  api:
    build: .
    ports: ["${API_PORT:-8000}:8000"]
    depends_on: [db, redis]

  frontend:
    build: ./frontend
    ports: ["${FRONTEND_PORT:-3000}:3000"]
    depends_on: [api]</code></pre>
                <p>
                    All ports and credentials are configured via environment variables in <code>.env</code>
                    (see <code>.env.example</code> for defaults). Copy and customize before starting.
                </p>
            </section>

            <!-- ============================================================ -->
            <!-- INSTALLATION -->
            <!-- ============================================================ -->
            <section id="installation">
                <h2>Installation</h2>

                <h3>Prerequisites</h3>
                <ul>
                    <li>Python 3.10 or later</li>
                    <li>Node.js 18 or later</li>
                    <li>Docker &amp; Docker Compose</li>
                </ul>

                <h3>Docker Compose (Recommended)</h3>
                <pre><code>git clone https://github.com/windmar-nav/windmar.git
cd windmar
cp .env.example .env    # Edit with your settings
docker compose up -d --build</code></pre>
                <p>
                    This starts all four services (PostgreSQL, Redis, API, frontend). By default the frontend is accessible
                    at <code>http://localhost:3000</code> and the backend API at <code>http://localhost:8000</code>.
                    Ports are configurable via <code>.env</code>.
                </p>

                <h3>Manual Setup</h3>
                <h4>Backend</h4>
                <pre><code>pip install -r requirements.txt
python api/main.py</code></pre>

                <h4>Frontend</h4>
                <pre><code>cd frontend
npm install --legacy-peer-deps
npm run dev</code></pre>

                <h3>Weather Data Sources</h3>
                <p>
                    WindMar uses a three-tier provider chain that automatically falls back when a source is unavailable.
                    See <a href="weather-data.html">Weather Data Acquisition</a> for full technical details.
                </p>
                <table>
                    <thead>
                        <tr><th>Data Type</th><th>Primary Source</th><th>Fallback</th><th>Credentials</th></tr>
                    </thead>
                    <tbody>
                        <tr><td>Wind</td><td>NOAA GFS (0.25&deg;)</td><td>ERA5 &rarr; Synthetic</td><td>None (free)</td></tr>
                        <tr><td>Waves</td><td>CMEMS wave model</td><td>Synthetic</td><td>CMEMS account</td></tr>
                        <tr><td>Currents</td><td>CMEMS physics model</td><td>Synthetic</td><td>CMEMS account</td></tr>
                        <tr><td>Forecast</td><td>GFS f000&ndash;f120 (5-day)</td><td>&mdash;</td><td>None</td></tr>
                    </tbody>
                </table>

                <div class="alert info">
                    <i class="fas fa-info-circle"></i>
                    <strong>Wind works out of the box</strong> &mdash; GFS data from NOAA NOMADS is freely available
                    without authentication. Only CMEMS wave/current data requires credentials.
                </div>

                <h3>Obtaining Weather Credentials</h3>
                <p><strong>CMEMS</strong> (waves and currents): Register at
                    <a href="https://marine.copernicus.eu/" target="_blank">marine.copernicus.eu</a>,
                    then set in <code>.env</code>:
                </p>
                <pre><code>COPERNICUSMARINE_SERVICE_USERNAME=your_username
COPERNICUSMARINE_SERVICE_PASSWORD=your_password</code></pre>

                <p><strong>CDS ERA5</strong> (wind fallback): Register at
                    <a href="https://cds.climate.copernicus.eu/" target="_blank">cds.climate.copernicus.eu</a>,
                    copy your Personal Access Token from your profile, then set:
                </p>
                <pre><code>CDSAPI_KEY=your_personal_access_token</code></pre>

                <h3>Environment Variables</h3>
                <p>Copy <code>.env.example</code> to <code>.env</code> and configure. Key variables:</p>
                <pre><code>DATABASE_URL=postgresql://windmar:password@db:5432/windmar
REDIS_URL=redis://:password@redis:6379/0
API_SECRET_KEY=generate_with_openssl_rand_hex_32
COPERNICUSMARINE_SERVICE_USERNAME=your_username
COPERNICUSMARINE_SERVICE_PASSWORD=your_password
CDSAPI_KEY=your_cds_personal_access_token</code></pre>

                <div class="alert warning">
                    <strong><i class="fas fa-exclamation-triangle"></i> Security</strong><br>
                    Never commit <code>.env</code> to version control. The <code>.gitignore</code> excludes it by default.
                    See <code>.env.example</code> for all available variables with descriptions.
                </div>
            </section>

            <!-- ============================================================ -->
            <!-- TECH STACK -->
            <!-- ============================================================ -->
            <section id="tech-stack">
                <h2>Tech Stack</h2>

                <h3>Backend</h3>
                <table>
                    <thead>
                        <tr><th>Library</th><th>Version</th><th>Purpose</th></tr>
                    </thead>
                    <tbody>
                        <tr><td>FastAPI</td><td>0.104+</td><td>REST API framework</td></tr>
                        <tr><td>Uvicorn</td><td>0.24+</td><td>ASGI server</td></tr>
                        <tr><td>SQLAlchemy</td><td>2.0+</td><td>ORM and database access</td></tr>
                        <tr><td>Pydantic</td><td>2.0+</td><td>Request/response validation</td></tr>
                        <tr><td>Alembic</td><td>1.13+</td><td>Database migrations</td></tr>
                    </tbody>
                </table>

                <h3>Frontend</h3>
                <table>
                    <thead>
                        <tr><th>Library</th><th>Version</th><th>Purpose</th></tr>
                    </thead>
                    <tbody>
                        <tr><td>Next.js</td><td>15</td><td>React framework with SSR</td></tr>
                        <tr><td>React</td><td>19</td><td>UI component library</td></tr>
                        <tr><td>Leaflet</td><td>1.9+</td><td>Map rendering and route display</td></tr>
                        <tr><td>Recharts</td><td>2.10+</td><td>Charts for fuel, CII, seakeeping data</td></tr>
                        <tr><td>Tailwind CSS</td><td>3.4+</td><td>Utility-first styling</td></tr>
                    </tbody>
                </table>

                <h3>Scientific Computing</h3>
                <table>
                    <thead>
                        <tr><th>Library</th><th>Version</th><th>Purpose</th></tr>
                    </thead>
                    <tbody>
                        <tr><td>NumPy</td><td>1.26+</td><td>Array operations, vector math</td></tr>
                        <tr><td>SciPy</td><td>1.11+</td><td>Optimization (Nelder-Mead), interpolation</td></tr>
                        <tr><td>global-land-mask</td><td>1.0+</td><td>Land/ocean grid classification</td></tr>
                        <tr><td>xarray</td><td>2024.1+</td><td>NetCDF weather data handling</td></tr>
                        <tr><td>copernicusmarine</td><td>1.0+</td><td>Copernicus CMEMS API client</td></tr>
                    </tbody>
                </table>

                <h3>Database &amp; Cache</h3>
                <table>
                    <thead>
                        <tr><th>Service</th><th>Version</th><th>Purpose</th></tr>
                    </thead>
                    <tbody>
                        <tr><td>PostgreSQL</td><td>16</td><td>Persistent storage for vessel specs, routes, zones</td></tr>
                        <tr><td>Redis</td><td>7</td><td>Weather field caching, session state</td></tr>
                    </tbody>
                </table>

                <h3>External APIs</h3>
                <table>
                    <thead>
                        <tr><th>Service</th><th>Data</th><th>Resolution</th></tr>
                    </thead>
                    <tbody>
                        <tr><td>Copernicus CMEMS</td><td>Significant wave height, wave period, wave direction</td><td>0.25 deg, 3-hourly</td></tr>
                        <tr><td>ERA5 Reanalysis</td><td>10m wind speed, wind direction</td><td>0.25 deg, hourly</td></tr>
                        <tr><td>Copernicus CMEMS</td><td>Ocean current speed and direction</td><td>0.083 deg, daily</td></tr>
                    </tbody>
                </table>
            </section>

            <!-- ============================================================ -->
            <!-- CALM WATER RESISTANCE -->
            <!-- ============================================================ -->
            <section id="calm-water">
                <h2>Calm Water Resistance</h2>

                <p>
                    Calm water resistance is the foundation of all fuel consumption predictions. WindMar implements the
                    Holtrop-Mennen method, the industry-standard empirical approach for estimating hull resistance of
                    displacement vessels. The method decomposes total resistance into frictional, wave-making, and
                    appendage components, each derived from the vessel's principal dimensions and hull form coefficients.
                </p>

                <h3>Holtrop-Mennen Method</h3>

                <div class="formula-block">
                    <div class="formula-title">Total Calm Water Resistance</div>
                    \[R_{\text{total}} = R_f + R_w + R_{\text{app}}\]
                    <div class="formula-where">
                        <p>Where:</p>
                        <ul>
                            <li>\(R_f\) = Frictional resistance (dominant at low Froude numbers)</li>
                            <li>\(R_w\) = Wave-making resistance (grows exponentially with speed)</li>
                            <li>\(R_{\text{app}}\) = Appendage resistance (rudder, shaft brackets, etc.)</li>
                        </ul>
                    </div>
                </div>

                <h3>A) Frictional Resistance (R_f)</h3>
                <p>
                    Frictional resistance arises from the viscous shear stress between the hull surface and the surrounding
                    water. It dominates at service speeds typical of MR tankers (Froude number 0.12-0.18). The ITTC 1957
                    model-ship correlation line provides the friction coefficient, and the Holtrop form factor accounts
                    for the three-dimensional shape of the hull.
                </p>

                <div class="formula-block">
                    <div class="formula-title">Frictional Resistance</div>
                    \[R_f = \tfrac{1}{2} \cdot \rho_{sw} \cdot V^2 \cdot S \cdot C_f \cdot (1 + k_1)\]
                    <div class="formula-where">
                        <p>Where:</p>
                        <ul>
                            <li>\(\rho_{sw} = 1025 \; \text{kg/m}^3\) (seawater density)</li>
                            <li>\(V\) = ship speed (m/s)</li>
                            <li>\(S\) = wetted surface area (m&sup2;)</li>
                            <li>\(C_f = \frac{0.075}{(\log_{10} Re - 2)^2}\) (ITTC 1957 friction line)</li>
                            <li>\(Re = \frac{V \cdot L_{pp}}{\nu_{sw}}\) (Reynolds number)</li>
                            <li>\(\nu_{sw} = 1.19 \times 10^{-6} \; \text{m}^2\text{/s}\) (kinematic viscosity at 15&deg;C)</li>
                        </ul>
                    </div>
                </div>

                <p>
                    At service speed of 13 knots (6.69 m/s) with L_pp = 176 m, the Reynolds number is approximately
                    9.9 &times; 10<sup>8</sup>, placing the flow firmly in the turbulent regime. The friction coefficient
                    C_f is then approximately 0.00148.
                </p>

                <h3>Form Factor (1 + k_1)</h3>
                <p>
                    The form factor corrects the flat-plate friction coefficient for the three-dimensional hull shape.
                    Holtrop-Mennen provides a regression formula for tanker hull forms based on the principal dimension
                    ratios and block coefficient.
                </p>

                <div class="formula-block">
                    <div class="formula-title">Holtrop-Mennen Form Factor for Tankers</div>
                    \[k_1 = \max\!\bigl(0.1,\; 0.93 + 0.4871 \cdot \frac{B}{L_{pp}} - 0.2156 \cdot \frac{B}{T} + 0.1027 \cdot C_b\bigr)\]
                    <div class="formula-where">
                        <p>Default MR tanker values:</p>
                        <ul>
                            <li>\(B / L_{pp} = 32 / 176 = 0.182\)</li>
                            <li>\(B / T_{\text{laden}} = 32 / 11.8 = 2.71\)</li>
                            <li>\(B / T_{\text{ballast}} = 32 / 6.5 = 4.92\)</li>
                            <li>\(C_{b,\text{laden}} = 0.82\)</li>
                            <li>\(C_{b,\text{ballast}} = 0.75\)</li>
                        </ul>
                        <p>Resulting form factors:</p>
                        <ul>
                            <li>\((1 + k_1)_{\text{laden}} = 1 + 0.93 + 0.4871 \times 0.182 - 0.2156 \times 2.71 + 0.1027 \times 0.82 \approx 1.52\)</li>
                            <li>\((1 + k_1)_{\text{ballast}} \approx 1.35\)</li>
                        </ul>
                    </div>
                </div>

                <h3>B) Wave-Making Resistance (R_w)</h3>
                <p>
                    Wave-making resistance is generated by the pressure field around the hull that creates surface waves.
                    For MR tankers operating at low Froude numbers (Fr &lt; 0.2), wave-making resistance is a small
                    fraction of total resistance. However, it increases exponentially with speed, making it the dominant
                    factor limiting maximum speed.
                </p>

                <div class="formula-block">
                    <div class="formula-title">Wave-Making Resistance (simplified empirical)</div>
                    \[R_w = 4.0 \cdot Fr^2 \cdot R_f\]
                    <div class="formula-where">
                        <p>Where:</p>
                        <ul>
                            <li>\(Fr = \frac{V}{\sqrt{g \cdot L_{pp}}}\) (Froude number)</li>
                            <li>\(R_f\) = frictional resistance (including form factor)</li>
                            <li>\(g = 9.81 \; \text{m/s}^2\)</li>
                        </ul>
                        <p>
                            For tankers with \(C_b > 0.75\) at low Froude numbers (\(Fr < 0.25\)),
                            \(R_w\) is a small fraction of total resistance, scaling quadratically with \(Fr\).
                            This simplified form avoids the full Holtrop-Mennen exponential coefficients
                            while remaining accurate for the operational speed range of merchant vessels.
                        </p>
                    </div>
                </div>

                <p>
                    At the design speed of 13 knots, the Froude number for an MR tanker is approximately
                    Fr = 6.69 / sqrt(9.81 &times; 176) &asymp; 0.161. The exponential term exp(-0.4 &times; 0.161<sup>-2</sup>)
                    is very small, confirming that wave-making resistance contributes less than 5% of total resistance
                    at service speed.
                </p>

                <h3>C) Appendage Resistance (R_app)</h3>
                <p>
                    Appendage resistance accounts for the drag of the rudder, propeller shaft brackets, bilge keels,
                    and other hull appendages. For MR tankers with standard appendage configurations, this is estimated
                    as a fixed percentage of frictional resistance.
                </p>

                <div class="formula-block">
                    <div class="formula-title">Appendage Resistance</div>
                    \[R_{\text{app}} = 0.05 \times R_f \quad \text{(5\% of frictional resistance)}\]
                </div>

                <h3>Default MR Tanker Specifications</h3>

                <table>
                    <thead>
                        <tr>
                            <th>Parameter</th>
                            <th>Laden</th>
                            <th>Ballast</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td>LOA</td><td>183.0 m</td><td>183.0 m</td></tr>
                        <tr><td>L_pp</td><td>176.0 m</td><td>176.0 m</td></tr>
                        <tr><td>Beam</td><td>32.0 m</td><td>32.0 m</td></tr>
                        <tr><td>Draft</td><td>11.8 m</td><td>6.5 m</td></tr>
                        <tr><td>Displacement</td><td>65,000 MT</td><td>20,000 MT</td></tr>
                        <tr><td>Block Coefficient (C_b)</td><td>0.82</td><td>0.75</td></tr>
                        <tr><td>Wetted Surface</td><td>7,500 m&sup2;</td><td>5,200 m&sup2;</td></tr>
                        <tr><td>Service Speed</td><td>13.0 kts</td><td>13.0 kts</td></tr>
                        <tr><td>DWT</td><td>49,000 MT</td><td>&mdash;</td></tr>
                        <tr><td>MCR</td><td>6,600 kW</td><td>6,600 kW</td></tr>
                        <tr><td>SFOC at MCR</td><td>171 g/kWh</td><td>171 g/kWh</td></tr>
                    </tbody>
                </table>
            </section>

            <!-- ============================================================ -->
            <!-- WIND RESISTANCE -->
            <!-- ============================================================ -->
            <section id="wind-resistance">
                <h2>Wind Resistance</h2>

                <p>
                    Wind resistance is computed using the Blendermann method, which models the aerodynamic forces on the
                    vessel's above-water structure as a function of relative wind speed, direction, and the vessel's
                    projected areas. The method accounts for both longitudinal (drag) and transverse (side force)
                    components, with the longitudinal component directly opposing forward motion and the transverse
                    component contributing indirectly through induced drift.
                </p>

                <h3>Blendermann Method</h3>

                <div class="formula-block">
                    <div class="formula-title">Relative Wind Angle</div>
                    \[\theta_{\text{rel}} = \left| \left( (\text{wind\_dir} - \text{heading}) + 180 \right) \bmod 360 - 180 \right|\]
                    <div class="formula-where">
                        <p>Range: \(0°\) (head wind) to \(180°\) (following wind)</p>
                    </div>
                </div>

                <div class="formula-block">
                    <div class="formula-title">Longitudinal Drag Coefficient</div>
                    <p>Simplified Blendermann for merchant vessels:</p>
                    \[C_{x,\text{drag}} = 0.8 \cdot \cos(\theta_{\text{rel}})\]
                    <p>Only the positive (opposing) component is used: \(C_{x,\text{drag}} = \max(0,\; C_{x,\text{drag}})\).</p>
                    <p>Transverse coefficient:</p>
                    \[C_y = 0.9 \cdot |\sin(\theta_{\text{rel}})|\]
                </div>

                <div class="formula-block">
                    <div class="formula-title">Wind Forces and Total Resistance</div>
                    <p>Direct (longitudinal) resistance:</p>
                    \[R_{\text{direct}} = \max(0,\; C_{x,\text{drag}}) \cdot \tfrac{1}{2} \cdot \rho_{\text{air}} \cdot V_{\text{wind}}^2 \cdot A_{\text{frontal}}\]
                    <p>Drift-induced resistance (10% of transverse force):</p>
                    \[R_{\text{drift}} = 0.1 \cdot C_y \cdot \tfrac{1}{2} \cdot \rho_{\text{air}} \cdot V_{\text{wind}}^2 \cdot A_{\text{lateral}}\]
                    <p>Total wind resistance:</p>
                    \[R_{\text{wind}} = R_{\text{direct}} + R_{\text{drift}}\]
                    <div class="formula-where">
                        <p>Where:</p>
                        <ul>
                            <li>\(\rho_{\text{air}} = 1.225 \; \text{kg/m}^3\) (air density at 15&deg;C, sea level)</li>
                            <li>\(V_{\text{wind}}\) = true wind speed (m/s)</li>
                            <li>\(A_{\text{frontal}}\) = projected frontal area (m&sup2;)</li>
                            <li>\(A_{\text{lateral}}\) = projected lateral area (m&sup2;)</li>
                        </ul>
                    </div>
                </div>

                <h3>Wind Projection Areas</h3>

                <table>
                    <thead>
                        <tr>
                            <th>Area</th>
                            <th>Laden</th>
                            <th>Ballast</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td>Frontal (A_frontal)</td><td>450 m&sup2;</td><td>850 m&sup2;</td></tr>
                        <tr><td>Lateral (A_lateral)</td><td>2,100 m&sup2;</td><td>2,800 m&sup2;</td></tr>
                    </tbody>
                </table>

                <div class="alert info">
                    <strong><i class="fas fa-info-circle"></i> Ballast Wind Exposure</strong><br>
                    In ballast condition the vessel rides higher, exposing 89% more frontal area (850 vs 450 m&sup2;) and
                    33% more lateral area (2,800 vs 2,100 m&sup2;) to the wind. This results in significantly higher
                    windage forces, particularly in head wind conditions where ballast wind resistance can exceed
                    laden resistance by a factor of two or more.
                </div>

                <h3>Physical Interpretation by Wind Angle</h3>
                <ul>
                    <li><strong>Head wind (0&deg;)</strong> &mdash; Maximum longitudinal resistance. C_x reaches its peak value. This is the worst-case scenario for fuel consumption.</li>
                    <li><strong>Beam wind (90&deg;)</strong> &mdash; Minimal longitudinal component but maximum transverse force. The 10% coupling factor from F_y captures the drift-induced resistance.</li>
                    <li><strong>Following wind (180&deg;)</strong> &mdash; Minimal resistance. The wind partially assists forward motion. C_x is near zero or slightly negative (assisting).</li>
                </ul>
            </section>

            <!-- ============================================================ -->
            <!-- WAVE RESISTANCE -->
            <!-- ============================================================ -->
            <section id="wave-resistance">
                <h2>Wave Resistance</h2>

                <p>
                    Wave added resistance is the increase in hull resistance caused by the vessel's interaction with
                    ocean waves. WindMar supports two methods: STAWAVE-1 (ISO 15016, default) and the Kwon empirical
                    speed-loss method. The Kwon method estimates added resistance by converting percentage speed loss
                    into equivalent resistance using the cubic power-speed relationship.
                </p>

                <h3>Kwon Speed-Loss Method</h3>

                <div class="formula-block">
                    <div class="formula-title">Base Speed Loss Coefficient</div>
                    \[\Delta V_{\text{base}} = 3.0 \cdot (1.7 - 0.9 \cdot C_b) \cdot \max\bigl(0.5,\; \min(1.5,\; 180 / L_{pp})\bigr)\]
                    <p>This gives a percentage speed loss per metre of significant wave height for head seas.
                       Higher \(C_b\) reduces speed loss; shorter vessels lose more speed.</p>
                </div>

                <div class="formula-block">
                    <div class="formula-title">Directional Reduction Factor</div>
                    <p>A stepped function of relative encounter angle \(\theta\):</p>
                    <table>
                        <thead><tr><th>Encounter Angle</th><th>\(f_{\text{dir}}\)</th></tr></thead>
                        <tbody>
                            <tr><td>0&deg;&ndash;30&deg; (head seas)</td><td>1.0</td></tr>
                            <tr><td>30&deg;&ndash;60&deg;</td><td>0.9</td></tr>
                            <tr><td>60&deg;&ndash;90&deg; (beam)</td><td>0.7</td></tr>
                            <tr><td>90&deg;&ndash;150&deg;</td><td>0.4</td></tr>
                            <tr><td>150&deg;&ndash;180&deg; (following)</td><td>0.2</td></tr>
                        </tbody>
                    </table>
                </div>

                <div class="formula-block">
                    <div class="formula-title">Speed Loss to Equivalent Resistance</div>
                    \[\Delta V_{\%} = \min\bigl(50,\; \Delta V_{\text{base}} \cdot H_s \cdot f_{\text{dir}}\bigr)\]
                    <p>The percentage speed loss is converted to an equivalent added resistance
                       using the cubic power-speed relationship (\(P \propto V^3\)):</p>
                    \[R_{\text{wave}} = R_{\text{calm}} \cdot 2.0 \cdot \frac{\Delta V_{\%}}{100}\]
                    <div class="formula-where">
                        <p>Where:</p>
                        <ul>
                            <li>\(H_s\) = significant wave height (m)</li>
                            <li>\(C_b\) = block coefficient (0.82 laden, 0.75 ballast)</li>
                            <li>\(L_{pp}\) = length between perpendiculars (m)</li>
                            <li>\(R_{\text{calm}}\) = Holtrop-Mennen calm water resistance at current speed</li>
                        </ul>
                    </div>
                </div>

                <p>
                    The Kwon method produces a quadratic dependence on wave height: doubling \(H_s\) from 2 m to 4 m
                    doubles the speed loss percentage, which doubles the added resistance. The stepped directional
                    factor ensures that head seas produce maximum added resistance while following seas retain a
                    residual 20% effect, reflecting the fact that even stern waves cause some added resistance
                    through ship-motion coupling.
                </p>

                <h3>Dual Wave Method (v0.0.8)</h3>
                <p>
                    Since v0.0.8, WindMar supports two wave added resistance methods, selectable via the
                    <code>wave_method</code> parameter on the vessel model:
                </p>
                <ul>
                    <li><strong><code>stawave1</code></strong> (default) &mdash; ISO 15016 STAWAVE-1 method.
                        A simplified, internationally standardized formula that estimates wave added resistance
                        from significant wave height, vessel length, beam, and block coefficient. Well-suited
                        for sea trial corrections and regulatory compliance calculations.</li>
                    <li><strong><code>kwon</code></strong> &mdash; Kwon empirical method (documented above).
                        Estimates speed loss percentage from wave height, vessel particulars, and encounter angle.
                        More physically detailed directional response; well-validated for merchant vessels at service speed.</li>
                </ul>
                <p>
                    Both methods are available via the <code>POST /api/vessel/predict</code> endpoint. The active method
                    is reported by <code>GET /api/vessel/model-status</code>.
                </p>

                <p>
                    For a laden MR tanker in head seas with H_s = 3 m at service speed (Fr &asymp; 0.161), the wave
                    added resistance is approximately:
                </p>

                <div class="formula-block">
                    <div class="formula-title">Example Calculation</div>
                    \[R_{\text{wave}} = 1.0 \times 4.5 \times 1025 \times 9.81 \times 32 \times 3^2 \times (1 + 0.161)\]
                    \[= 1.0 \times 4.5 \times 1025 \times 9.81 \times 32 \times 9 \times 1.161 \approx 15{,}200 \; \text{N} \approx 15.2 \; \text{kN}\]
                </div>
            </section>

            <!-- ============================================================ -->
            <!-- SFOC CURVE -->
            <!-- ============================================================ -->
            <section id="sfoc-curve">
                <h2>SFOC Curve</h2>

                <p>
                    Specific Fuel Oil Consumption (SFOC) describes the mass of fuel consumed per unit of energy delivered
                    by the engine. It varies with engine load: marine diesel engines have an optimal efficiency zone
                    around 75% of Maximum Continuous Rating (MCR), with increasing specific consumption at both lower
                    and higher loads. WindMar models this behavior with a piecewise linear correction applied to the
                    MCR reference SFOC.
                </p>

                <div class="formula-block">
                    <div class="formula-title">SFOC Load Correction</div>
                    <p>Below optimal load (\(l_f < 0.75\)):</p>
                    \[\text{SFOC} = \text{SFOC}_{MCR} \times \bigl(1.0 + 0.15 \times (0.75 - l_f)\bigr)\]
                    <p>At or above optimal load (\(l_f \ge 0.75\)):</p>
                    \[\text{SFOC} = \text{SFOC}_{MCR} \times \bigl(1.0 + 0.05 \times (l_f - 0.75)\bigr)\]
                    <div class="formula-where">
                        <p>Constraints:</p>
                        <ul>
                            <li>\(l_f = \max\bigl(0.15,\; \min(1.0,\; P_{\text{brake}} / P_{MCR})\bigr)\)</li>
                            <li>\(\text{SFOC}_{MCR} = 171 \; \text{g/kWh}\) (manufacturer specification)</li>
                        </ul>
                    </div>
                </div>

                <p>
                    The asymmetric correction reflects the physical reality of diesel engine combustion: at low loads,
                    incomplete combustion and thermal losses increase specific consumption more steeply (15% penalty
                    per 0.1 load fraction below 75%) than the mild increase at high loads (5% penalty per 0.1 above 75%)
                    caused by increased cylinder pressures and thermal stress.
                </p>

                <h3>SFOC Behavior by Engine Load</h3>

                <table>
                    <thead>
                        <tr>
                            <th>Engine Load</th>
                            <th>SFOC (g/kWh)</th>
                            <th>Efficiency Note</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td>15% (minimum)</td><td>~186</td><td>Minimum load limit; high specific consumption</td></tr>
                        <tr><td>50%</td><td>~177</td><td>Part-load penalty; below optimal range</td></tr>
                        <tr><td>75%</td><td>~171</td><td>Optimal operating point; minimum SFOC</td></tr>
                        <tr><td>85%</td><td>~172</td><td>Near optimal; slight overload penalty</td></tr>
                        <tr><td>100% (MCR)</td><td>~173</td><td>Full load; mild thermal penalty</td></tr>
                    </tbody>
                </table>

                <p>
                    The engine load is clamped to the range [0.15, 1.0]. Below 15% load, the engine is considered
                    non-operational. Above 100% MCR, the engine cannot deliver more power, so the brake power is
                    capped at P_MCR = 6,600 kW.
                </p>

                <h3>SFOC Calibration Factor (v0.0.8)</h3>
                <p>
                    Since v0.0.8, the SFOC curve supports a multiplicative calibration factor (<code>sfoc_factor</code>)
                    derived from engine log analysis. When the vessel is calibrated from actual noon report or engine log
                    data, the optimizer may determine that the manufacturer's SFOC reference is over- or under-estimated.
                    The corrected SFOC is:
                </p>
                <div class="formula-block">
                    <div class="formula-title">Calibrated SFOC</div>
                    \[\text{SFOC}_{\text{calibrated}}(l_f) = \text{SFOC}(l_f) \times k_{\text{sfoc}}\]
                    <div class="formula-where">
                        <p>Where:</p>
                        <ul>
                            <li>\(k_{\text{sfoc}}\) = SFOC calibration factor (default 1.0, typically 0.9&ndash;1.15)</li>
                            <li>\(\text{SFOC}(l_f)\) = uncalibrated piecewise curve from above</li>
                        </ul>
                    </div>
                </div>
                <p>
                    The factor is stored alongside the hull calibration factors (<code>calm_water</code>,
                    <code>wind</code>, <code>waves</code>) and is applied globally to all fuel consumption
                    calculations, route optimization, and CII compliance estimates. It is set via
                    <code>POST /api/vessel/calibrate</code> or <code>POST /api/engine-log/calibrate</code>.
                </p>
            </section>

            <!-- ============================================================ -->
            <!-- PROPULSION CHAIN -->
            <!-- ============================================================ -->
            <section id="propulsion-chain">
                <h2>Propulsion Chain</h2>

                <p>
                    The propulsion chain converts total hull resistance into brake power demand and then into fuel
                    consumption. It accounts for the efficiencies of the propeller, the hull-propeller interaction,
                    and the relative rotative efficiency of the propulsion system.
                </p>

                <h3>Brake Power Calculation</h3>

                <div class="formula-block">
                    <div class="formula-title">Tow Power to Brake Power</div>
                    <p>Tow power (power to overcome resistance):</p>
                    \[P_{\text{tow}} = \frac{R_{\text{total}} \cdot V}{1000} \quad [\text{kW}]\]
                    <div class="formula-where">
                        <p>Where:</p>
                        <ul>
                            <li>\(R_{\text{total}} = R_{\text{calm}} + R_{\text{wind}} + R_{\text{wave}}\) [N]</li>
                            <li>\(V\) = ship speed [m/s]</li>
                        </ul>
                    </div>
                    <p>Brake power (engine output):</p>
                    \[P_{\text{brake}} = \frac{P_{\text{tow}}}{\eta_{\text{prop}} \cdot \eta_{\text{hull}} \cdot \eta_{\text{rre}}}\]
                    <div class="formula-where">
                        <p>Where:</p>
                        <ul>
                            <li>\(\eta_{\text{prop}} = 0.65\) (propeller open-water efficiency)</li>
                            <li>\(\eta_{\text{hull}} = 1.05\) (hull efficiency; &gt; 1 due to wake gain)</li>
                            <li>\(\eta_{\text{rre}} = 1.00\) (relative rotative efficiency)</li>
                        </ul>
                    </div>
                    <p>Combined propulsive efficiency:</p>
                    \[\eta_{\text{total}} = \eta_{\text{prop}} \cdot \eta_{\text{hull}} \cdot \eta_{\text{rre}} = 0.65 \times 1.05 \times 1.00 = 0.6825\]
                    <p>Power capped at MCR:</p>
                    \[P_{\text{brake}} = \min(P_{\text{brake}},\; P_{MCR}) \quad \text{where } P_{MCR} = 6{,}600 \; \text{kW}\]
                </div>

                <p>
                    Hull efficiency exceeds 1.0 because the wake behind the hull reduces the effective inflow velocity
                    to the propeller relative to the ship speed. The propeller operates in a flow field that is
                    slower than the free-stream velocity, requiring less thrust to overcome the same resistance.
                </p>

                <h3>Fuel Consumption</h3>

                <div class="formula-block">
                    <div class="formula-title">Fuel Consumption per Time Step</div>
                    \[\text{Fuel} \; [\text{MT}] = \frac{P_{\text{brake}} \times \text{SFOC} \times t_{\text{hours}}}{1{,}000{,}000}\]
                    <div class="formula-where">
                        <p>Where:</p>
                        <ul>
                            <li>\(P_{\text{brake}}\) = brake power [kW]</li>
                            <li>\(\text{SFOC}\) = specific fuel oil consumption [g/kWh] (load-dependent)</li>
                            <li>\(t_{\text{hours}}\) = duration of the leg [hours]</li>
                            <li>\(1{,}000{,}000\) = conversion from grams to metric tonnes</li>
                        </ul>
                    </div>
                </div>

                <p>
                    For example, at service speed in calm water with P_brake = 5,500 kW and SFOC = 172 g/kWh,
                    a 24-hour transit consumes approximately:
                </p>
                <pre><code>Fuel = (5500 &times; 172 &times; 24) / 1,000,000 = 22.7 MT/day</code></pre>
            </section>

            <!-- ============================================================ -->
            <!-- SHIP MOTIONS -->
            <!-- ============================================================ -->
            <section id="ship-motions">
                <h2>Ship Motions</h2>

                <p>
                    Ship motion prediction is essential for seakeeping assessment and safety enforcement during route
                    optimization. WindMar implements simplified strip-theory models for roll, pitch, and vertical
                    acceleration. These models provide physically meaningful motion estimates that capture the dominant
                    effects of wave height, encounter frequency, and vessel loading condition.
                </p>

                <h3>Roll Motion &mdash; Single DOF Oscillator</h3>
                <p>
                    Roll is modeled as a single degree-of-freedom oscillator driven by the transverse wave slope.
                    The response amplitude operator (RAO) captures the frequency-dependent magnification, with
                    resonance occurring when the encounter frequency matches the vessel's natural roll frequency.
                </p>

                <div class="formula-block">
                    <div class="formula-title">Roll Amplitude</div>
                    <p>Roll amplitude [rad]:</p>
                    \[\phi = \frac{\text{wave\_slope}}{GM} \cdot \frac{H_s}{2} \cdot \text{RAO} \cdot \sin(\theta_{\text{beam}})\]
                    <p>Response Amplitude Operator:</p>
                    \[\text{RAO} = \frac{1}{\sqrt{\left(1 - \left(\frac{\omega_e}{\omega_{\text{roll}}}\right)^2\right)^2 + \left(2 \zeta \cdot \frac{\omega_e}{\omega_{\text{roll}}}\right)^2}}\]
                    <div class="formula-where">
                        <p>Where:</p>
                        <ul>
                            <li>\(\omega_{\text{roll}} = \frac{2\pi}{T_{\text{roll}}}\) (natural roll frequency)</li>
                            <li>\(T_{\text{roll}}\): 14 s (laden), 10 s (ballast)</li>
                            <li>\(\zeta = 0.05\) (5% critical damping)</li>
                            <li>\(GM\): 2.5 m (laden), 4.0 m (ballast)</li>
                            <li>\(\theta_{\text{beam}}\) = angle from beam (90&deg; = pure beam seas)</li>
                            <li>\(\omega_e\) = encounter frequency (depends on ship speed &amp; heading)</li>
                        </ul>
                    </div>
                </div>

                <p>
                    The natural roll period is longer in laden condition (14 s) due to the higher metacentric height
                    combined with greater mass moment of inertia. Ballast condition has a shorter period (10 s)
                    because the higher GM (4.0 m) produces a stiffer restoring moment relative to the reduced inertia.
                    The 5% critical damping ratio is conservative and accounts for hull friction, bilge keel effects,
                    and cargo damping.
                </p>

                <h3>Pitch Motion</h3>
                <p>
                    Pitch is driven primarily by head seas and bow-quarter seas. The amplitude depends on the wave
                    slope, the encounter angle (maximum in head seas), and a pitch factor that captures the
                    wavelength-to-ship-length tuning effect.
                </p>

                <div class="formula-block">
                    <div class="formula-title">Pitch Amplitude</div>
                    <p>Pitch amplitude [deg]:</p>
                    \[\theta_{\text{pitch}} = 10 \cdot \text{wave\_slope} \cdot |\cos(\theta_{\text{enc}})| \cdot f_{\text{pitch}}\]
                    <p>Pitch factor depends on \(L/\lambda\) ratio:</p>
                    \[f_{\text{pitch}} = \begin{cases} 2 \cdot (L / \lambda) & L/\lambda < 0.5 \\ 1 - 0.3 \cdot |L/\lambda - 1| & 0.5 \le L/\lambda < 1.5 \\ 0.5 / (L / \lambda) & L/\lambda \ge 1.5 \end{cases}\]
                    <div class="formula-where">
                        <p>Where:</p>
                        <ul>
                            <li>\(\lambda = \frac{g \cdot T_{\text{wave}}^2}{2\pi}\) (deep water wavelength)</li>
                            <li>\(L = L_{pp} = 176 \; \text{m}\)</li>
                            <li>\(T_{\text{wave}}\) = peak wave period (s)</li>
                        </ul>
                    </div>
                </div>

                <p>
                    The pitch factor peaks near L/&lambda; = 1 (ship length equals wavelength), where the vessel
                    "straddles" consecutive wave crests and troughs, producing maximum pitching motion. When the
                    wavelength is much shorter or longer than the ship, the pitch factor decreases because the
                    vessel either averages out multiple short waves or rides on a single long wave slope.
                </p>

                <h3>Vertical Acceleration</h3>
                <p>
                    Vertical acceleration at specific locations along the ship length combines the heave acceleration
                    at the center of gravity with the pitch-induced acceleration component. Points far from midship
                    (bridge, bow) experience amplified accelerations due to the pitch lever arm.
                </p>

                <div class="formula-block">
                    <div class="formula-title">Vertical Acceleration</div>
                    <p>Heave acceleration (at center of gravity):</p>
                    \[a_{\text{heave}} = \frac{H_s}{2} \cdot \omega_e^2 \cdot \bigl(0.3 + 0.7 \cdot \cos(\theta_{\text{enc}})\bigr)\]
                    <p>Point acceleration (at distance \(x\) from midship):</p>
                    \[a_{\text{point}} = \sqrt{a_{\text{heave}}^2 + \bigl(x \cdot \theta_{\text{pitch,rad}} \cdot \omega_e^2\bigr)^2}\]
                    <div class="formula-where">
                        <p>Reference locations:</p>
                        <ul>
                            <li>Bridge: \(x = -70\) m from midship (aft)</li>
                            <li>Bow: \(x = +88\) m from midship (forward)</li>
                            <li>Midship: \(x = 0\) m (minimum acceleration)</li>
                        </ul>
                    </div>
                </div>

                <p>
                    The bow experiences the highest vertical accelerations because it is the farthest point forward
                    from the pitch axis. At the bridge (70 m aft of midship), accelerations are also amplified but
                    less than at the bow. Vertical acceleration is the primary crew comfort criterion and drives
                    speed reduction decisions in heavy weather.
                </p>
            </section>

            <!-- ============================================================ -->
            <!-- SAFETY CRITERIA -->
            <!-- ============================================================ -->
            <section id="safety-criteria">
                <h2>Safety Criteria</h2>

                <p>
                    WindMar enforces safety at two levels: <strong>hard avoidance limits</strong> that instantly
                    reject extreme conditions, and a <strong>three-tier motion-based classification</strong>
                    (Safe, Marginal, Dangerous) computed from the seakeeping model. Both are applied during
                    route optimization by the A* engine (and VISIR Dijkstra when enabled).
                </p>

                <h3>Hard Avoidance Limits (v0.0.8)</h3>

                <p>
                    These absolute thresholds are checked <em>before</em> computing vessel motions. Any grid cell
                    exceeding either limit is assigned infinite cost &mdash; the optimizer cannot route through it
                    regardless of heading or speed. These values are calibrated for an MR Product Tanker (~50k DWT).
                </p>

                <table>
                    <thead>
                        <tr>
                            <th>Parameter</th>
                            <th>Threshold</th>
                            <th>Equivalent</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Significant wave height (Hs)</td>
                            <td><strong>&ge; 6.0&thinsp;m</strong></td>
                            <td>Beaufort 9+ (severe gale)</td>
                        </tr>
                        <tr>
                            <td>Wind speed</td>
                            <td><strong>&ge; 70&thinsp;kts</strong></td>
                            <td>Beaufort 12 (hurricane force)</td>
                        </tr>
                    </tbody>
                </table>

                <h3>Motion-Based Safety Limits</h3>

                <table>
                    <thead>
                        <tr>
                            <th>Motion Parameter</th>
                            <th>Safe</th>
                            <th>Marginal</th>
                            <th>Dangerous</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Roll amplitude</td>
                            <td>&lt; 15&deg;</td>
                            <td>15&deg; &ndash; 25&deg;</td>
                            <td>&gt; 25&deg;</td>
                        </tr>
                        <tr>
                            <td>Pitch amplitude</td>
                            <td>&lt; 5&deg;</td>
                            <td>5&deg; &ndash; 8&deg;</td>
                            <td>&gt; 8&deg;</td>
                        </tr>
                        <tr>
                            <td>Vertical acceleration</td>
                            <td>&lt; 0.2g</td>
                            <td>0.2g &ndash; 0.3g</td>
                            <td>&gt; 0.5g</td>
                        </tr>
                        <tr>
                            <td>Slamming probability</td>
                            <td>&lt; 3%</td>
                            <td>3% &ndash; 10%</td>
                            <td>&gt; 10%</td>
                        </tr>
                    </tbody>
                </table>

                <div class="alert warning">
                    <strong><i class="fas fa-exclamation-triangle"></i> Route Optimization Enforcement</strong><br>
                    Safety criteria are enforced by the routing engines. Grid cells classified as
                    <strong>Dangerous</strong> receive a graduated penalty (2&times; to 5&times; cost, or infinite
                    above 1.5&times; the dangerous threshold). <strong>Marginal</strong> cells receive a penalty
                    proportional to the exceedance above safe limits. <strong>Safe</strong> cells use
                    the nominal fuel-based cost. In both engines, safety penalties apply to fuel cost only &mdash;
                    the time penalty remains unweighted to prevent artificial inflation of detour costs.
                </div>

                <p>
                    The overall safety classification for a cell is determined by the worst-case criterion: if any
                    single parameter falls in the Dangerous range, the cell is classified as Dangerous regardless
                    of the other parameters.
                </p>
            </section>

            <!-- ============================================================ -->
            <!-- SLAMMING & PARAMETRIC ROLL -->
            <!-- ============================================================ -->
            <section id="slamming-roll">
                <h2>Slamming &amp; Parametric Roll</h2>

                <h3>Slamming (Ochi Criteria)</h3>
                <p>
                    Slamming occurs when the bow emerges from the water and re-enters with high velocity, generating
                    impulsive loads on the hull structure. The Ochi criteria estimate the probability of slamming
                    based on bow emergence and re-entry velocity. Slamming risk is highest in ballast condition
                    (lower forward draft) and head seas.
                </p>

                <div class="formula-block">
                    <div class="formula-title">Bow Vertical Motion at Forward Perpendicular</div>
                    \[y_{\text{bow}} = \frac{H_s}{2} + L_{fp} \cdot \sin(\theta_{\text{pitch}})\]
                    <div class="formula-where">
                        <p>Where:</p>
                        <ul>
                            <li>\(H_s\) = significant wave height (m)</li>
                            <li>\(L_{fp}\) = distance from midship to forward perpendicular (m)</li>
                            <li>\(\theta_{\text{pitch}}\) = pitch amplitude (rad)</li>
                        </ul>
                    </div>
                </div>

                <div class="formula-block">
                    <div class="formula-title">Emergence Probability and Impact Velocity</div>
                    <p>Emergence probability:</p>
                    \[P_{\text{emergence}} = f(y_{\text{bow}},\; \text{freeboard})\]
                    <p>When \(y_{\text{bow}}\) exceeds bow freeboard, the bow emerges from the water and slamming becomes possible on re-entry.</p>
                    <p>Re-entry velocity:</p>
                    \[v_{\text{impact}} = \sqrt{2 \cdot g \cdot \max(0,\; y_{\text{bow}} - \text{freeboard})}\]
                    <div class="formula-where">
                        <p>Where:</p>
                        <ul>
                            <li>\(g = 9.81 \; \text{m/s}^2\)</li>
                            <li>freeboard = distance from waterline to deck at bow (m)</li>
                            <li>Laden: freeboard \(\approx 5.2\) m</li>
                            <li>Ballast: freeboard \(\approx 10.5\) m (higher deck but lower draft = more emergence)</li>
                        </ul>
                    </div>
                </div>

                <p>
                    Despite the higher freeboard in ballast, the reduced forward draft means the keel rises above
                    the still water surface more frequently, particularly in head seas. The combination of high
                    emergence amplitude and significant re-entry velocity produces the impulsive slamming loads
                    that can cause structural damage to the forward hull plating.
                </p>

                <h3>Parametric Roll Risk</h3>
                <p>
                    Parametric rolling is a dangerous phenomenon where roll amplitudes build up rapidly due to
                    periodic variation in the vessel's waterplane area (and thus stability) as waves pass along
                    the hull. It occurs primarily in head or following seas when the wave encounter period is
                    approximately twice the natural roll period.
                </p>

                <div class="formula-block">
                    <div class="formula-title">Parametric Roll Conditions</div>
                    <p>Parametric roll risk is elevated when:</p>
                    <ol>
                        <li>Encounter period ratio: \(\frac{T_{\text{wave}}}{T_{\text{roll}}} \approx 2.0\) &ensp; (tolerance: \(1.8 < T_{\text{wave}}/T_{\text{roll}} < 2.2\))</li>
                        <li>Wave height exceeds critical threshold: \(H_s > H_{\text{critical}}\)</li>
                        <li>Head seas or following seas: \(\theta_{\text{encounter}} < 30°\) or \(\theta_{\text{encounter}} > 150°\)</li>
                    </ol>
                    <p>When all three conditions are met, the route cell is flagged for elevated parametric roll risk.</p>
                </div>

                <p>
                    Parametric roll can develop in just a few wave cycles, reaching amplitudes of 30&ndash;40 degrees
                    or more. It is particularly dangerous because it can occur in moderate sea states where other
                    motion criteria appear safe. Detection and avoidance through route optimization is a key
                    safety feature.
                </p>
            </section>

            <!-- ============================================================ -->
            <!-- A* ALGORITHM -->
            <!-- ============================================================ -->
            <section id="astar-algorithm">
                <h2>A* Algorithm</h2>

                <p>
                    Route optimization uses the A* pathfinding algorithm to find the minimum-cost path through a
                    weather-dependent grid. Each grid cell has a traversal cost determined by the fuel consumption
                    required to cross it at the locally optimal speed, considering all resistance components and
                    safety constraints.
                </p>

                <h3>Grid Construction</h3>
                <ul>
                    <li><strong>Resolution</strong>: Configurable, default 0.5 degrees (~30 nm at the equator)</li>
                    <li><strong>Land masking</strong>: Land cells are removed using the <code>global-land-mask</code> library, which provides a 1-km resolution land/ocean classification</li>
                    <li><strong>Corridor</strong>: The search grid extends &plusmn;5 degrees latitude and longitude around the direct great-circle route to limit search space while allowing sufficient deviation for weather routing</li>
                    <li><strong>Connectivity</strong>: 8-connected grid (cardinal + diagonal neighbors)</li>
                </ul>

                <h3>A* Search</h3>

                <div class="formula-block">
                    <div class="formula-title">A* Cost Function</div>
                    \[f(n) = g(n) + h(n)\]
                    <div class="formula-where">
                        <p>Where:</p>
                        <ul>
                            <li>\(f(n)\) = total estimated cost of path through node \(n\)</li>
                            <li>\(g(n)\) = actual cost from start to node \(n\) (accumulated fuel consumption)</li>
                            <li>\(h(n)\) = heuristic estimate of cost from node \(n\) to goal</li>
                        </ul>
                    </div>
                    <p>Heuristic:</p>
                    \[h(n) = d_{\text{goal}} \times r_{\text{fuel,min}}\]
                    <p>(admissible: never overestimates actual cost)</p>
                    <p>Move cost (node \(m\) to neighbor \(n\)):</p>
                    \[\text{cost}(m, n) = \text{fuel\_consumption}(m, n, V_{\text{optimal}})\]
                    <div class="formula-where">
                        <p>Where fuel_consumption accounts for:</p>
                        <ul>
                            <li>Calm water resistance (Holtrop-Mennen)</li>
                            <li>Wind resistance (Blendermann) at local wind conditions</li>
                            <li>Wave resistance (Kwon) at local wave conditions</li>
                            <li>Engine SFOC at resulting load</li>
                            <li>Safety penalty multiplier (\(1.0\times\) safe, \(1.5\times\) marginal, \(\infty\) dangerous)</li>
                        </ul>
                    </div>
                    <p>Diagonal cost:</p>
                    \[\text{cost}_{\text{diagonal}} = \sqrt{2} \times \text{cost}_{\text{cardinal}}\]
                </div>

                <h3>Search Procedure</h3>
                <ol>
                    <li>Initialize priority queue (min-heap ordered by f-score) with start node</li>
                    <li>Pop node with lowest f-score</li>
                    <li>If goal reached, reconstruct path and return</li>
                    <li>For each of 8 neighbors:
                        <ul>
                            <li>Skip if land cell or already visited with lower cost</li>
                            <li>Compute weather at neighbor location (interpolated from grid)</li>
                            <li>Compute fuel cost to traverse cell at optimal speed</li>
                            <li>Apply safety and regulatory zone multipliers</li>
                            <li>Update neighbor's g-score if new path is cheaper</li>
                            <li>Add to priority queue</li>
                        </ul>
                    </li>
                    <li>Terminate if cells explored exceeds 200,000 (A*) or 150,000 (Dijkstra)</li>
                </ol>

                <h3>Cost Calculation Code</h3>
                <pre><code>def compute_cell_cost(self, from_cell, to_cell, weather):
    """Compute fuel cost to traverse a grid cell."""
    distance_nm = haversine(from_cell.lat, from_cell.lon,
                            to_cell.lat, to_cell.lon)

    # Find optimal speed for this cell
    best_fuel = float('inf')
    best_speed = self.vessel.service_speed

    for speed_kts in np.linspace(6.0, 18.0, 7):
        speed_ms = speed_kts * 0.5144

        # Total resistance
        r_calm = self.vessel.calm_water_resistance(speed_ms)
        r_wind = self.vessel.wind_resistance(
            speed_ms, weather.wind_speed, weather.wind_dir,
            self.heading)
        r_wave = self.vessel.wave_resistance(
            speed_ms, weather.wave_height, weather.wave_dir,
            self.heading)
        r_total = r_calm + r_wind + r_wave

        # Brake power and fuel
        p_tow = r_total * speed_ms / 1000
        p_brake = min(p_tow / self.vessel.eta_total,
                      self.vessel.mcr)
        sfoc = self.vessel.sfoc(p_brake / self.vessel.mcr)
        time_h = distance_nm / speed_kts
        fuel_mt = p_brake * sfoc * time_h / 1e6

        if fuel_mt &lt; best_fuel:
            best_fuel = fuel_mt
            best_speed = speed_kts

    # Apply safety multiplier
    safety = self.assess_safety(weather, best_speed)
    if safety == 'dangerous':
        return float('inf')
    elif safety == 'marginal':
        best_fuel *= 1.5

    return best_fuel</code></pre>

                <h3>Path Smoothing</h3>
                <p>
                    After A* finds the optimal grid path, a two-stage smoothing pass produces a natural route:
                </p>
                <p><strong>Stage 1: Douglas-Peucker simplification.</strong> Iteratively removes intermediate waypoints, checking:</p>
                <ul>
                    <li>The straight-line segment does not cross land</li>
                    <li>The fuel consumption difference is within 1% of the unsmoothed path</li>
                    <li>All intermediate points maintain safe seakeeping conditions</li>
                </ul>
                <p><strong>Stage 2: Turn-angle filter (v0.0.6).</strong> Removes waypoints where the course change
                    is below 15&deg;, eliminating grid staircase artifacts from the 8-connected A* output. Before removing
                    a waypoint, the filter verifies that the resulting direct segment does not cross land.</p>
            </section>

            <!-- ============================================================ -->
            <!-- VARIABLE SPEED -->
            <!-- ============================================================ -->
            <section id="variable-speed">
                <h2>Variable Speed Optimization</h2>

                <p>
                    Rather than maintaining a constant speed throughout the voyage, WindMar optimizes speed
                    independently for each leg of the route. This allows the vessel to slow down in adverse
                    weather (reducing resistance cubically) and speed up in calm conditions, minimizing total
                    fuel consumption for the voyage.
                </p>

                <h3>Per-Leg Speed Optimization</h3>
                <ul>
                    <li><strong>Speed range</strong>: 6 to 18 knots, tested at 7 discrete values (6, 8, 10, 12, 14, 16, 18 kts)</li>
                    <li><strong>Objective</strong>: Minimize fuel consumption per nautical mile for each leg</li>
                    <li><strong>Weather-dependent</strong>: The optimal speed varies with local wind, wave, and current conditions</li>
                    <li><strong>Power constraint</strong>: Speed is limited by MCR &mdash; if the required brake power exceeds MCR at a given speed, that speed is not achievable</li>
                </ul>

                <div class="formula-block">
                    <div class="formula-title">Speed Optimization Objective</div>
                    <p>For each leg \(i\) with distance \(d_i\) and weather conditions \(w_i\):</p>
                    \[V_i^* = \arg\min_{V} \left[ \frac{\text{fuel}(V, w_i)}{d_i} \right]\]
                    <p>Subject to:</p>
                    \[6 \; \text{kts} \le V \le 18 \; \text{kts}, \quad P_{\text{brake}}(V, w_i) \le P_{MCR}\]
                    \[\text{fuel}(V, w_i) = \frac{P_{\text{brake}}(V, w_i) \times \text{SFOC}(\text{load}) \times (d_i / V)}{10^6}\]
                </div>

                <p>
                    The cubic relationship between speed and resistance means that a small speed reduction produces
                    a large fuel saving. For example, reducing speed from 14 to 12 knots (14% reduction) can reduce
                    fuel consumption by approximately 35% per hour, although the voyage takes longer. The optimizer
                    balances this trade-off based on the fuel-per-mile metric.
                </p>

                <h3>Dual Speed-Strategy Comparison (v0.0.6)</h3>
                <p>
                    After the A* algorithm finds the optimal path, WindMar computes two speed strategies and
                    presents them side by side so the navigator can choose the appropriate trade-off:
                </p>

                <table>
                    <thead>
                        <tr><th>Strategy</th><th>Speed Profile</th><th>Effect</th></tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Same Speed</strong></td>
                            <td>Run the optimized path at the same constant speed used in the voyage baseline</td>
                            <td>Arrive earlier than baseline (shorter distance). Moderate fuel savings from distance reduction alone.</td>
                        </tr>
                        <tr>
                            <td><strong>Match ETA</strong></td>
                            <td>Slow-steam on the optimized path so that total voyage time matches the baseline arrival time</td>
                            <td>Same arrival time as baseline. Maximum fuel savings by exploiting both shorter distance and lower speed.</td>
                        </tr>
                    </tbody>
                </table>

                <h3>Optimization Workflow</h3>
                <p>The complete user-facing workflow is:</p>
                <ol>
                    <li><strong>Set waypoints</strong> on the map (draw or import RTZ)</li>
                    <li><strong>Calculate Voyage</strong> &mdash; computes the baseline: fuel, time, and distance at constant calm speed along the user&rsquo;s drawn route</li>
                    <li><strong>Optimize A*</strong> (enabled only after step 2) &mdash; finds the weather-optimal path and computes both speed strategies</li>
                    <li><strong>Compare</strong> &mdash; the route comparison panel shows two tabs (Same Speed / Match ETA) with a table comparing baseline vs. optimized distance, fuel, time, average speed, and waypoint count</li>
                    <li><strong>Apply or Dismiss</strong> &mdash; the navigator selects a strategy and applies it, or dismisses to keep the original route</li>
                </ol>
                <p>
                    The original route (blue) and optimized route (green dashed) are displayed simultaneously on the
                    map so the navigator can visually assess the deviation before committing.
                </p>

                <div class="alert info">
                    <i class="fas fa-info-circle"></i>
                    <strong>Voyage baseline gating</strong> &mdash; The Optimize A* button is disabled until a voyage
                    calculation has been performed. This ensures that the baseline fuel and time values are available
                    for meaningful percentage savings in the comparison table. Without a baseline, the optimizer would
                    have no reference to compute &ldquo;Same Speed&rdquo; or &ldquo;Match ETA&rdquo; scenarios against.
                </div>
            </section>

            <!-- ============================================================ -->
            <!-- SAFETY CONSTRAINTS -->
            <!-- ============================================================ -->
            <section id="safety-constraints">
                <h2>Safety Constraints</h2>

                <p>
                    Safety constraints are integrated directly into the routing engines, ensuring
                    that neither optimizer produces a route that violates safety criteria or regulatory requirements.
                    Constraints are applied at three levels: hard avoidance, seakeeping safety, and regulatory zone enforcement.
                </p>

                <h3>Hard Avoidance (Pre-Motion Check)</h3>
                <ul>
                    <li><strong>Hs &ge; 6&thinsp;m or wind &ge; 70&thinsp;kts</strong>: Cell cost = infinity.
                        Checked before computing vessel motions, making this a cheap gate that prevents
                        the optimizer from even considering extreme sea states.</li>
                </ul>

                <h3>Seakeeping Constraints</h3>
                <ul>
                    <li><strong>Dangerous conditions</strong>: Graduated penalty (2&times; to 5&times;) based on
                        severity of exceedance. Extreme conditions (&gt;1.5&times; the dangerous threshold) are
                        assigned infinite cost, forcing the route around the hazardous area.</li>
                    <li><strong>Marginal conditions</strong>: Penalty proportional to exceedance above safe limits
                        (roll and pitch). The optimizer can still route through the cell but prefers alternatives.</li>
                    <li><strong>Safe conditions</strong>: Nominal fuel-based cost with no penalty.</li>
                </ul>

                <h3>Cost Formula (v0.0.8)</h3>
                <p>
                    Both engines use a time-constrained fuel minimization cost:
                </p>
                <p style="text-align: center; font-style: italic; margin: 1rem 0;">
                    cost = fuel &times; safety &times; zone &times; ice + &lambda;<sub>time</sub> &times; hours
                </p>
                <p>
                    Safety, zone, and ice multipliers apply <strong>only to the fuel term</strong>. The time penalty
                    (&lambda;<sub>time</sub> = service-speed hourly fuel &times; 0.3) remains unweighted. This
                    prevents the optimizer from over-penalizing direct routes in rough weather, which would
                    otherwise produce detours that consume more fuel than the direct path.
                </p>

                <h3>Regulatory Zone Enforcement</h3>
                <p>
                    Regulatory zones modify the A* cost function based on the zone type. Three enforcement modes
                    are supported:
                </p>

                <table>
                    <thead>
                        <tr>
                            <th>Zone Type</th>
                            <th>Effect on A* Cost</th>
                            <th>Example</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>EXCLUSION</strong></td>
                            <td>cost = infinity (blocks route)</td>
                            <td>HRA (High Risk Areas), environmental exclusion zones</td>
                        </tr>
                        <tr>
                            <td><strong>PENALTY</strong></td>
                            <td>cost &times; penalty_factor</td>
                            <td>ECA (Emission Control Areas) requiring fuel switching</td>
                        </tr>
                        <tr>
                            <td><strong>MANDATORY</strong></td>
                            <td>Ensures path includes zone</td>
                            <td>TSS (Traffic Separation Schemes), mandatory reporting points</td>
                        </tr>
                    </tbody>
                </table>

                <p>
                    Exclusion zones and penalty zones are applied per-cell during the A* expansion. Mandatory
                    zones are enforced as waypoint constraints: the route must pass through at least one cell
                    in each mandatory zone.
                </p>
            </section>

            <!-- ============================================================ -->
            <!-- GSHHS COASTLINE (v0.1.0) -->
            <!-- ============================================================ -->
            <section id="gshhs-coastline">
                <h2>GSHHS Coastline Integration</h2>

                <p>
                    WindMar v0.1.0 replaces the <code>global-land-mask</code> package (1&thinsp;km raster grid) with
                    GSHHS (Global Self-consistent, Hierarchical, High-resolution Shoreline) vector polygons. This
                    provides sub-km accuracy for land detection, critical for nearshore routing and strait navigation.
                </p>

                <h3>Implementation</h3>
                <ul>
                    <li><strong>Shapefile loading</strong> &mdash; GSHHS shapefiles are loaded once at startup and cached for the session lifetime</li>
                    <li><strong>Point-in-polygon</strong> &mdash; land/ocean queries use <code>shapely</code> prepared geometries for O(log n) performance</li>
                    <li><strong>Fallback</strong> &mdash; if GSHHS shapefiles are not installed, the system falls back to <code>global-land-mask</code> with a startup warning</li>
                    <li><strong>Resolution</strong> &mdash; uses GSHHS &ldquo;intermediate&rdquo; resolution (i) by default, balancing accuracy against memory</li>
                </ul>

                <div class="alert info">
                    <i class="fas fa-info-circle"></i>
                    <strong>Why vector polygons?</strong> &mdash; Raster land masks discretize the coastline onto a fixed grid. At narrow
                    straits (e.g., Gibraltar, 14&thinsp;km), a 1&thinsp;km grid can falsely block valid shipping channels. Vector polygons
                    test the exact coastline geometry.
                </div>
            </section>

            <!-- ============================================================ -->
            <!-- VARIABLE RESOLUTION GRID (v0.1.0) -->
            <!-- ============================================================ -->
            <section id="variable-resolution">
                <h2>Variable Resolution Grid</h2>

                <p>
                    The routing graph uses an adaptive resolution corridor around the great-circle path between
                    origin and destination. This concentrates computational effort where it matters most &mdash;
                    near coastlines and obstacles &mdash; while keeping the open-ocean grid coarse for efficiency.
                </p>

                <h3>Resolution Tiers</h3>
                <table>
                    <thead>
                        <tr><th>Zone</th><th>Resolution</th><th>Trigger</th></tr>
                    </thead>
                    <tbody>
                        <tr><td>Nearshore</td><td>0.1&deg; (~11&thinsp;km)</td><td>Within 50&thinsp;km of coastline</td></tr>
                        <tr><td>Transition</td><td>0.25&deg; (~28&thinsp;km)</td><td>50&ndash;200&thinsp;km from coast</td></tr>
                        <tr><td>Open ocean</td><td>0.5&deg; (~56&thinsp;km)</td><td>More than 200&thinsp;km from coast</td></tr>
                    </tbody>
                </table>

                <h3>Cross-Tier Connectivity</h3>
                <p>
                    Nodes at resolution boundaries are connected with 16-neighbor connectivity, ensuring smooth
                    transitions between tiers. The optimizer can route freely across resolution boundaries without
                    artificial cost penalties or path discontinuities.
                </p>
            </section>

            <!-- ============================================================ -->
            <!-- STRAIT SHORTCUTS (v0.1.0) -->
            <!-- ============================================================ -->
            <section id="strait-shortcuts">
                <h2>Strait Visibility Graph</h2>

                <p>
                    Nine pre-validated shipping straits are modelled as visibility graph edges, allowing the optimizer
                    to transit narrow passages that would be blocked or poorly represented by the regular grid.
                    Gibraltar is split into separate eastbound and westbound straits for TSS compliance.
                </p>

                <h3>Supported Straits</h3>
                <table>
                    <thead>
                        <tr><th>Code</th><th>Strait</th><th>Notes</th></tr>
                    </thead>
                    <tbody>
                        <tr><td>GIBR_EB</td><td>Gibraltar &mdash; Eastbound</td><td>Atlantic&rarr;Mediterranean; one-way TSS lane</td></tr>
                        <tr><td>GIBR_WB</td><td>Gibraltar &mdash; Westbound</td><td>Mediterranean&rarr;Atlantic; one-way TSS lane</td></tr>
                        <tr><td>DOVR</td><td>Dover Strait</td><td>34&thinsp;km; busiest shipping lane globally</td></tr>
                        <tr><td>MLCA</td><td>Malacca Strait</td><td>2.8&thinsp;km min; Asia&ndash;Europe critical chokepoint</td></tr>
                        <tr><td>HRMZ</td><td>Hormuz</td><td>39&thinsp;km; Persian Gulf exit</td></tr>
                        <tr><td>BABE</td><td>Bab el-Mandeb</td><td>26&thinsp;km; Red Sea&ndash;Gulf of Aden</td></tr>
                        <tr><td>BOSP</td><td>Bosporus</td><td>~700&thinsp;m; narrow (GSHHS-i cannot resolve)</td></tr>
                        <tr><td>SUEZ</td><td>Suez Approach</td><td>Port Said approach waypoints; canal is narrow</td></tr>
                        <tr><td>MESS</td><td>Messina</td><td>3.1&thinsp;km; Tyrrhenian&ndash;Ionian passage</td></tr>
                    </tbody>
                </table>

                <p>
                    Each strait is defined as an ordered sequence of safe waypoints (not just entry/exit) with
                    pre-validated coordinates verified against navigational charts. The visibility graph merges these
                    edges into the main routing graph so the optimizer can choose strait transit naturally as part of
                    the shortest-path search. Narrow straits (Bosporus, Suez) skip the GSHHS land-crossing check
                    because the coastline resolution cannot resolve sub-kilometre channels.
                </p>
            </section>

            <!-- ============================================================ -->
            <!-- PARETO FRONT (v0.1.0) -->
            <!-- ============================================================ -->
            <section id="pareto-front">
                <h2>Multi-Objective Pareto Front</h2>

                <p>
                    Instead of selecting a single fuel&ndash;time tradeoff parameter (&lambda;), WindMar sweeps a range of
                    &lambda; values and returns the full Pareto front: the set of routes where no other route is
                    simultaneously faster <em>and</em> more fuel-efficient.
                </p>

                <h3>Lambda Sweep</h3>
                <p>
                    The optimizer runs multiple Dijkstra passes with &lambda; values spanning from fuel-minimizing
                    (low &lambda;) to time-minimizing (high &lambda;). Each pass produces a route with a specific
                    fuel/time pair. Dominated routes are discarded, leaving only the Pareto-optimal set.
                </p>

                <h3>Smart Default Selection</h3>
                <p>
                    The recommended operating point is selected automatically as the &ldquo;knee&rdquo; of the Pareto curve &mdash;
                    the point of maximum curvature where marginal fuel savings per hour of delay are highest. Users can
                    override this by clicking any point on the interactive Pareto chart in the analysis panel.
                </p>

                <h3>Speed Granularity</h3>
                <p>
                    The optimizer evaluates speeds in 0.5&thinsp;kt increments (e.g., 10.0, 10.5, 11.0, &hellip; 16.0 kts),
                    providing fine-grained control over the fuel&ndash;time tradeoff. This replaces the earlier 2&thinsp;kt steps
                    for more realistic operational speed profiles.
                </p>
            </section>

            <!-- ============================================================ -->
            <!-- IMO CII RATING -->
            <!-- ============================================================ -->
            <section id="cii-rating">
                <h2>IMO CII Rating</h2>

                <p>
                    The Carbon Intensity Indicator (CII) is a mandatory IMO measure under MEPC.339(76) that rates
                    a ship's operational carbon efficiency on an A-to-E scale. WindMar calculates the attained CII
                    for a voyage and compares it against the required CII to determine the rating. This enables
                    operators to assess whether a planned voyage will contribute positively or negatively to their
                    annual CII rating.
                </p>

                <h3>Attained CII</h3>

                <div class="formula-block">
                    <div class="formula-title">Attained Carbon Intensity Indicator</div>
                    \[\text{CII}_{\text{attained}} = \frac{\text{Total CO}_2 \; [\text{MT}] \times 10^6}{\text{Capacity} \; [\text{DWT}] \times \text{Distance} \; [\text{nm}]}\]
                    <p>Unit: grams CO<sub>2</sub> per deadweight-tonne per nautical mile [g CO<sub>2</sub> / DWT&middot;nm]</p>
                    <div class="formula-where">
                        <p>Where:</p>
                        <ul>
                            <li>Total CO<sub>2</sub> = Total fuel consumed [MT] \(\times\) CO<sub>2</sub> emission factor [g CO<sub>2</sub> / g fuel]</li>
                            <li>Capacity = vessel DWT (49,000 MT for MR tanker)</li>
                            <li>Distance = total voyage distance [nm]</li>
                        </ul>
                    </div>
                </div>

                <h3>Required CII</h3>

                <div class="formula-block">
                    <div class="formula-title">Required CII with Annual Reduction</div>
                    \[\text{CII}_{\text{ref}} = a \cdot \text{Capacity}^{-c}\]
                    \[\text{CII}_{\text{req}} = \text{CII}_{\text{ref}} \times \left(1 - \frac{Z}{100}\right)\]
                    <div class="formula-where">
                        <p>Where:</p>
                        <ul>
                            <li>\(a = 5247\) (tanker reference parameter, MEPC.339(76))</li>
                            <li>\(c = 0.610\) (tanker capacity exponent, MEPC.339(76))</li>
                            <li>\(Z\) = reduction factor (% per year, increasing annually)</li>
                        </ul>
                    </div>
                </div>

                <h3>Rating Boundaries</h3>

                <table>
                    <thead>
                        <tr>
                            <th>Rating</th>
                            <th>Condition</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td><strong>A</strong> (Superior)</td><td>Attained &le; 0.82 &times; Required</td></tr>
                        <tr><td><strong>B</strong> (Good)</td><td>0.82 &lt; Attained &le; 0.93 &times; Required</td></tr>
                        <tr><td><strong>C</strong> (Moderate)</td><td>0.93 &lt; Attained &le; 1.08 &times; Required</td></tr>
                        <tr><td><strong>D</strong> (Below average)</td><td>1.08 &lt; Attained &le; 1.28 &times; Required</td></tr>
                        <tr><td><strong>E</strong> (Inferior)</td><td>Attained &gt; 1.28 &times; Required</td></tr>
                    </tbody>
                </table>

                <h3>Annual Reduction Factors</h3>

                <table>
                    <thead>
                        <tr>
                            <th>Year</th>
                            <th>Reduction Factor (Z)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td>2023</td><td>5%</td></tr>
                        <tr><td>2024</td><td>7%</td></tr>
                        <tr><td>2025</td><td>9%</td></tr>
                        <tr><td>2026</td><td>11%</td></tr>
                        <tr><td>2027</td><td>13%</td></tr>
                        <tr><td>2028</td><td>15%</td></tr>
                        <tr><td>2029</td><td>17%</td></tr>
                        <tr><td>2030</td><td>19%</td></tr>
                    </tbody>
                </table>

                <h3>CO2 Emission Factors</h3>

                <table>
                    <thead>
                        <tr>
                            <th>Fuel Type</th>
                            <th>g CO2 / g fuel</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td>HFO (Heavy Fuel Oil)</td><td>3.114</td></tr>
                        <tr><td>VLSFO (Very Low Sulphur Fuel Oil)</td><td>3.114</td></tr>
                        <tr><td>MDO (Marine Diesel Oil)</td><td>3.206</td></tr>
                        <tr><td>LNG (Liquefied Natural Gas)</td><td>2.750</td></tr>
                    </tbody>
                </table>
            </section>

            <!-- ============================================================ -->
            <!-- REGULATORY ZONES -->
            <!-- ============================================================ -->
            <section id="regulatory-zones">
                <h2>Regulatory Zones</h2>

                <p>
                    WindMar supports the definition and enforcement of regulatory zones that constrain route
                    optimization. Zones are defined as GeoJSON polygons and classified by type, each with a
                    specific effect on the A* cost function.
                </p>

                <h3>Zone Types</h3>

                <table>
                    <thead>
                        <tr>
                            <th>Zone Type</th>
                            <th>Description</th>
                            <th>Effect</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>ECA</strong></td>
                            <td>Emission Control Areas (SOx/NOx)</td>
                            <td>Penalty cost (fuel switching overhead)</td>
                        </tr>
                        <tr>
                            <td><strong>HRA</strong></td>
                            <td>High Risk Areas (piracy, conflict)</td>
                            <td>Exclusion (route blocked)</td>
                        </tr>
                        <tr>
                            <td><strong>TSS</strong></td>
                            <td>Traffic Separation Schemes</td>
                            <td>Mandatory (route must include)</td>
                        </tr>
                    </tbody>
                </table>

                <h3>GeoJSON Import/Export</h3>
                <p>
                    Zones are stored as GeoJSON Feature Collections. Each feature includes a <code>properties</code>
                    object specifying the zone type, name, and any associated parameters (e.g., penalty factor).
                </p>

                <pre><code>{
  "type": "FeatureCollection",
  "features": [
    {
      "type": "Feature",
      "properties": {
        "name": "North Sea ECA",
        "zone_type": "PENALTY",
        "penalty_factor": 1.3
      },
      "geometry": {
        "type": "Polygon",
        "coordinates": [[[...], [...], ...]]
      }
    }
  ]
}</code></pre>

                <h3>Point-in-Polygon Detection</h3>
                <p>
                    During A* expansion, each candidate cell is tested against all active regulatory zones using
                    the ray casting algorithm. For a point (lat, lon), the algorithm casts a horizontal ray and
                    counts the number of intersections with the polygon boundary. An odd count means the point
                    is inside the polygon; an even count means outside.
                </p>
            </section>

            <!-- ============================================================ -->
            <!-- FUELEU MARITIME (v0.1.0) -->
            <!-- ============================================================ -->
            <section id="fueleu-maritime">
                <h2>FuelEU Maritime Compliance</h2>

                <p>
                    The EU FuelEU Maritime regulation (2025) mandates progressive reduction in the greenhouse gas
                    intensity of energy used on board ships. WindMar calculates Well-to-Wake GHG intensity per voyage
                    and tracks compliance against the regulatory trajectory.
                </p>

                <h3>GHG Intensity Calculation</h3>
                <p>
                    GHG intensity is measured as grams of CO<sub>2</sub>-equivalent per megajoule of energy consumed
                    (gCO<sub>2</sub>eq/MJ), using Well-to-Wake emission factors that include upstream fuel production
                    emissions. WindMar applies the default factors from Annex II of the regulation.
                </p>

                <h3>Compliance Balance</h3>
                <p>
                    Each voyage generates a compliance surplus (if below the reference intensity) or deficit (if above).
                    Surpluses and deficits accumulate over the compliance period and can be banked or borrowed across years
                    within regulatory limits.
                </p>

                <h3>Pooling &amp; Penalties</h3>
                <ul>
                    <li><strong>Pooling scenarios</strong> &mdash; model compliance balance sharing between vessels in a fleet pool</li>
                    <li><strong>Penalty estimator</strong> &mdash; calculates financial exposure if the compliance deficit exceeds the allowed threshold</li>
                </ul>

                <h3>4-Tab Interface</h3>
                <p>
                    The FuelEU page provides four tabs: <strong>Calculator</strong> (per-voyage GHG intensity),
                    <strong>Compliance</strong> (balance tracking), <strong>Pooling</strong> (fleet scenarios), and
                    <strong>Projections</strong> (future year trajectory).
                </p>
            </section>

            <!-- ============================================================ -->
            <!-- VOYAGE REPORTING (v0.1.0) -->
            <!-- ============================================================ -->
            <section id="voyage-reporting">
                <h2>Voyage Reporting</h2>

                <p>
                    WindMar generates structured voyage reports from completed route calculations, following
                    IMO-standard formats used across the commercial shipping industry.
                </p>

                <h3>Report Types</h3>
                <ul>
                    <li><strong>Noon report</strong> &mdash; daily position, speed, fuel consumption, and weather conditions in IMO format</li>
                    <li><strong>Departure report</strong> &mdash; vessel condition at sailing: drafts, bunker quantities, cargo, ETA</li>
                    <li><strong>Arrival report</strong> &mdash; end-of-voyage summary with actual vs. planned comparison</li>
                </ul>

                <h3>PDF Export</h3>
                <p>
                    All report types can be exported to PDF with a company branding placeholder for operator customization.
                    Voyage history is searchable and filterable by date range, port pair, and vessel.
                </p>
            </section>

            <!-- ============================================================ -->
            <!-- CHARTER PARTY WEATHER CLAUSES (v0.1.0) -->
            <!-- ============================================================ -->
            <section id="charter-party">
                <h2>Charter Party Weather Clause Tools</h2>

                <p>
                    Charter party agreements typically include weather clauses that define &ldquo;good weather&rdquo;
                    conditions for performance assessment. WindMar provides tools to verify compliance with these
                    clauses using route weather data and engine log records.
                </p>

                <h3>Good Weather Day Counter</h3>
                <p>
                    Counts the number of days along a route where conditions fall within the agreed Beaufort scale
                    thresholds (typically BF &le; 4 or BF &le; 5). This is the standard metric for assessing whether
                    warranted speed/consumption claims are valid.
                </p>

                <h3>Warranted Performance Verification</h3>
                <ul>
                    <li><strong>Speed verification</strong> &mdash; compares actual speed through water against the warranted speed during good weather days</li>
                    <li><strong>Consumption verification</strong> &mdash; compares actual fuel consumption against warranted consumption during good weather days</li>
                </ul>

                <h3>Off-Hire Detection</h3>
                <p>
                    Identifies periods in engine log data where the vessel was effectively off-hire (speed below a
                    configurable threshold, extended port stays, or mechanical downtime), which are excluded from
                    performance assessments.
                </p>
            </section>

            <!-- ============================================================ -->
            <!-- WEATHER API -->
            <!-- ============================================================ -->
            <section id="weather-api">
                <h2>Weather API</h2>

                <p>
                    The Weather API provides access to weather fields for the route optimization
                    grid and map visualization. Wind data is sourced from NOAA GFS (primary) with ERA5 fallback.
                    Wave and current data comes from Copernicus CMEMS. Weather fields are cached in-memory for
                    repeated queries. See <a href="weather-data.html">Weather Data Acquisition</a> for full details.
                </p>

                <h3>Grid Endpoints</h3>

                <div class="endpoint">
                    <span class="endpoint-method method-get">GET</span>
                    <span class="endpoint-path">/api/weather/wind</span>
                    <p class="endpoint-description">Returns the wind field grid (U/V components) for a bounding box.</p>
                    <p><strong>Query Parameters:</strong></p>
                    <ul>
                        <li><code>lat_min</code>, <code>lat_max</code> &mdash; Latitude bounds (default: 30&ndash;60)</li>
                        <li><code>lon_min</code>, <code>lon_max</code> &mdash; Longitude bounds (default: -15&ndash;40)</li>
                        <li><code>resolution</code> &mdash; Grid resolution in degrees (default: 0.25)</li>
                        <li><code>time</code> &mdash; Optional ISO 8601 datetime</li>
                    </ul>
                    <p><strong>Response:</strong> JSON with <code>lats</code>, <code>lons</code>, <code>u</code>, <code>v</code> 2D arrays, <code>source</code> (gfs/era5/synthetic), ocean mask.</p>
                </div>

                <div class="endpoint">
                    <span class="endpoint-method method-get">GET</span>
                    <span class="endpoint-path">/api/weather/wind/velocity</span>
                    <p class="endpoint-description">Wind data in <a href="https://github.com/danwild/leaflet-velocity">leaflet-velocity</a> JSON format for particle animation.</p>
                    <p><strong>Query Parameters:</strong> Same as <code>/api/weather/wind</code>, plus <code>forecast_hour</code> (0&ndash;120, step 3).</p>
                    <p><strong>Source:</strong> NOAA GFS via NOMADS GRIB filter.</p>
                </div>

                <div class="endpoint">
                    <span class="endpoint-method method-get">GET</span>
                    <span class="endpoint-path">/api/weather/waves</span>
                    <p class="endpoint-description">Wave field grid (significant height, period, direction) from CMEMS.</p>
                    <p><strong>Query Parameters:</strong> Same bounding box + <code>time</code>.</p>
                </div>

                <div class="endpoint">
                    <span class="endpoint-method method-get">GET</span>
                    <span class="endpoint-path">/api/weather/currents</span>
                    <p class="endpoint-description">Ocean current field grid (U/V components) from CMEMS.</p>
                    <p><strong>Query Parameters:</strong> Same bounding box + <code>time</code>.</p>
                </div>

                <div class="endpoint">
                    <span class="endpoint-method method-get">GET</span>
                    <span class="endpoint-path">/api/weather/currents/velocity</span>
                    <p class="endpoint-description">Ocean currents in leaflet-velocity JSON format for particle animation.</p>
                </div>

                <h3>Forecast Endpoints</h3>

                <div class="endpoint">
                    <span class="endpoint-method method-get">GET</span>
                    <span class="endpoint-path">/api/weather/forecast/status</span>
                    <p class="endpoint-description">Returns GFS run info and which forecast hours (f000&ndash;f120) are cached.</p>
                    <p><strong>Response:</strong> <code>run_date</code>, <code>run_hour</code>, <code>total_hours</code> (41), <code>cached_hours</code>, <code>complete</code> flag, <code>prefetch_running</code> flag.</p>
                </div>

                <div class="endpoint">
                    <span class="endpoint-method method-post">POST</span>
                    <span class="endpoint-path">/api/weather/forecast/prefetch</span>
                    <p class="endpoint-description">Triggers background download of all 41 GFS forecast hours (f000&ndash;f120, 3h steps). Skips already-cached files. Rate-limited to 2s between NOMADS requests.</p>
                </div>

                <div class="endpoint">
                    <span class="endpoint-method method-get">GET</span>
                    <span class="endpoint-path">/api/weather/forecast/frames</span>
                    <p class="endpoint-description">Bulk returns all cached forecast frames in leaflet-velocity format. Single response containing all 41 frames (~5&ndash;20 MB). Frontend calls this once after prefetch completes.</p>
                </div>
            </section>

            <!-- ============================================================ -->
            <!-- ROUTE API -->
            <!-- ============================================================ -->
            <section id="route-api">
                <h2>Route API</h2>

                <p>
                    The Route API handles route optimization requests, waypoint-based route calculation,
                    RTZ file parsing, and voyage planning with ETA computation.
                </p>

                <div class="endpoint">
                    <span class="endpoint-method method-post">POST</span>
                    <span class="endpoint-path">/api/optimize/route</span>
                    <p class="endpoint-description">Full weather-aware route optimization using A* pathfinding with variable speed optimization.</p>
                    <p><strong>Request Body:</strong></p>
                    <pre><code>{
  "departure": {
    "lat": 51.95,
    "lon": 1.33,
    "name": "Rotterdam"
  },
  "arrival": {
    "lat": 29.75,
    "lon": -93.85,
    "name": "Houston"
  },
  "departure_time": "2026-02-10T08:00:00Z",
  "vessel_condition": "laden",
  "optimization_objective": "fuel",
  "grid_resolution": 0.5,
  "speed_range": [6.0, 18.0],
  "enable_safety_constraints": true,
  "regulatory_zones": ["eca_north_sea", "tss_dover"]
}</code></pre>
                    <p><strong>Response:</strong></p>
                    <pre><code>{
  "route": {
    "waypoints": [
      {"lat": 51.95, "lon": 1.33, "speed_kts": 14.0, "fuel_mt": 0.0},
      {"lat": 50.50, "lon": -2.10, "speed_kts": 13.5, "fuel_mt": 12.4},
      ...
    ],
    "total_distance_nm": 5120,
    "total_fuel_mt": 285.3,
    "total_time_hours": 372.5,
    "eta": "2026-02-25T20:30:00Z"
  },
  "cii": {
    "attained": 4.82,
    "required": 5.31,
    "rating": "B"
  },
  "safety_summary": {
    "max_roll_deg": 12.3,
    "max_pitch_deg": 4.1,
    "max_acceleration_g": 0.18,
    "dangerous_cells_avoided": 14,
    "marginal_cells_traversed": 7
  },
  "legs": [
    {
      "from": {"lat": 51.95, "lon": 1.33},
      "to": {"lat": 50.50, "lon": -2.10},
      "distance_nm": 156,
      "speed_kts": 13.5,
      "fuel_mt": 12.4,
      "time_hours": 11.6,
      "weather": {
        "wind_speed_ms": 8.2,
        "wind_dir": 245,
        "wave_height_m": 2.1,
        "wave_dir": 260
      }
    }
  ]
}</code></pre>
                </div>

                <div class="endpoint">
                    <span class="endpoint-method method-post">POST</span>
                    <span class="endpoint-path">/api/routes/from-waypoints</span>
                    <p class="endpoint-description">Calculate fuel consumption and ETA for a user-defined waypoint sequence (no optimization, fixed route).</p>
                    <p><strong>Request Body:</strong></p>
                    <pre><code>{
  "waypoints": [
    {"lat": 51.95, "lon": 1.33},
    {"lat": 48.50, "lon": -5.10},
    {"lat": 29.75, "lon": -93.85}
  ],
  "departure_time": "2026-02-10T08:00:00Z",
  "vessel_condition": "laden",
  "speed_kts": 13.0
}</code></pre>
                </div>

                <div class="endpoint">
                    <span class="endpoint-method method-post">POST</span>
                    <span class="endpoint-path">/api/routes/parse-rtz</span>
                    <p class="endpoint-description">Parse an RTZ (Route Transfer Exchange) file per IEC 61174 standard and extract waypoints.</p>
                    <p><strong>Request Body:</strong> Multipart form data with RTZ XML file.</p>
                </div>

                <div class="endpoint">
                    <span class="endpoint-method method-post">POST</span>
                    <span class="endpoint-path">/api/voyage/calculate</span>
                    <p class="endpoint-description">Full voyage calculation with intermediate port calls, bunkering stops, and ETAs for each leg.</p>
                </div>
            </section>

            <!-- ============================================================ -->
            <!-- VESSEL API -->
            <!-- ============================================================ -->
            <section id="vessel-api">
                <h2>Vessel API</h2>

                <p>
                    The Vessel API manages vessel specifications, calibration, and compliance calculations.
                </p>

                <div class="endpoint">
                    <span class="endpoint-method method-get">GET</span>
                    <span class="endpoint-path">/api/vessel/specs</span>
                    <p class="endpoint-description">Returns the current vessel specifications including dimensions, areas, engine parameters, and loading condition.</p>
                </div>

                <div class="endpoint">
                    <span class="endpoint-method method-post">POST</span>
                    <span class="endpoint-path">/api/vessel/specs</span>
                    <p class="endpoint-description">Update vessel specifications. All physical model parameters (wetted surface, wind areas, block coefficient, etc.) are recalculated from the updated dimensions.</p>
                    <p><strong>Request Body:</strong></p>
                    <pre><code>{
  "loa": 183.0,
  "lpp": 176.0,
  "beam": 32.0,
  "draft_laden": 11.8,
  "draft_ballast": 6.5,
  "displacement_laden": 65000,
  "displacement_ballast": 20000,
  "dwt": 49000,
  "mcr_kw": 6600,
  "sfoc_mcr": 171,
  "service_speed_laden": 13.0,
  "service_speed_ballast": 13.0
}</code></pre>
                </div>

                <div class="endpoint">
                    <span class="endpoint-method method-post">POST</span>
                    <span class="endpoint-path">/api/vessel/calibrate</span>
                    <p class="endpoint-description">Calibrate vessel performance model using noon report data. Accepts an Excel file with voyage data and returns optimized calibration factors.</p>
                    <p><strong>Request Body:</strong> Multipart form data with Excel file (.xlsx).</p>
                    <p><strong>Response:</strong></p>
                    <pre><code>{
  "calibration_factors": {
    "calm_water": 1.12,
    "wind": 0.95,
    "waves": 1.08,
    "sfoc_factor": 1.03
  },
  "rmse_before": 3.45,
  "rmse_after": 1.23,
  "improvement_pct": 64.3,
  "data_points": 42
}</code></pre>
                </div>

                <!-- ============================================================ -->
                <!-- PERFORMANCE PREDICTOR (v0.0.8) -->
                <!-- ============================================================ -->
                <section id="performance-predictor" style="margin-top: 2rem;">
                <h3>Performance Predictor (v0.0.8)</h3>
                <p>
                    The performance predictor uses a bisection solver (30 iterations, ~0.001 kts precision) to answer
                    two complementary questions: given an engine load, what speed can the vessel achieve? Or given a
                    target calm-water speed, what engine load is required? All directions use the <strong>relative
                    convention</strong>: 0&deg; = dead ahead, 90&deg; = beam, 180&deg; = astern.
                </p>

                <div class="endpoint">
                    <span class="endpoint-method method-post">POST</span>
                    <span class="endpoint-path">/api/vessel/predict</span>
                    <p class="endpoint-description">Predict vessel performance under specified weather conditions. Supports two modes: <strong>engine load mode</strong> (provide <code>engine_load_pct</code>) or <strong>target speed mode</strong> (provide <code>calm_speed_kts</code>).</p>
                    <p><strong>Request Body (Mode 1 &mdash; Engine Load):</strong></p>
                    <pre><code>{
  "is_laden": true,
  "engine_load_pct": 85,
  "wind_speed_kts": 20,
  "wind_relative_deg": 0,
  "wave_height_m": 2.5,
  "wave_relative_deg": 30,
  "current_speed_kts": 1.0,
  "current_relative_deg": 180
}</code></pre>
                    <p><strong>Request Body (Mode 2 &mdash; Target Speed):</strong></p>
                    <pre><code>{
  "is_laden": true,
  "calm_speed_kts": 13.0,
  "wind_speed_kts": 25,
  "wind_relative_deg": 0,
  "wave_height_m": 3.0,
  "wave_relative_deg": 0,
  "current_speed_kts": 0.5,
  "current_relative_deg": 0
}</code></pre>
                    <p><strong>Response:</strong></p>
                    <pre><code>{
  "speed_through_water_kts": 13.28,
  "speed_over_ground_kts": 12.78,
  "fuel_consumption_mt_per_day": 28.4,
  "fuel_consumption_mt_per_nm": 0.093,
  "engine_load_pct": 85.0,
  "speed_loss_pct": 8.4,
  "resistance_breakdown_kn": {
    "calm_water": 142.5,
    "wind": 38.2,
    "wave": 15.4
  },
  "mode": "engine_load",
  "mcr_exceeded": false
}</code></pre>
                    <div class="alert info">
                        <i class="fas fa-info-circle"></i>
                        <strong>MCR capping</strong> &mdash; In target speed mode, if the required power exceeds MCR,
                        the response includes <code>"mcr_exceeded": true</code> and <code>required_power_kw</code>.
                        The achievable speed is capped at the maximum speed deliverable at 100% MCR.
                    </div>
                </div>

                <div class="endpoint">
                    <span class="endpoint-method method-get">GET</span>
                    <span class="endpoint-path">/api/vessel/model-status</span>
                    <p class="endpoint-description">Returns the complete vessel model state: all 20 VesselSpecs fields (grouped by dimensions, engine, areas), current calibration factors with timestamp, active wave method, and computed values (optimal speeds, fuel at service speed).</p>
                    <p><strong>Response (abbreviated):</strong></p>
                    <pre><code>{
  "specifications": {
    "dimensions": {
      "loa": 183.0, "lpp": 176.0, "beam": 32.0,
      "draft_laden": 11.8, "draft_ballast": 6.5,
      "dwt": 49000, "displacement_laden": 65000, "displacement_ballast": 20000
    },
    "hull_form": {
      "cb_laden": 0.82, "cb_ballast": 0.75,
      "wetted_surface_laden": 7500, "wetted_surface_ballast": 5200
    },
    "engine": {
      "mcr_kw": 6600, "sfoc_at_mcr": 171,
      "service_speed_laden": 13.0, "service_speed_ballast": 13.0
    },
    "areas": {
      "frontal_area_laden": 450, "frontal_area_ballast": 850,
      "lateral_area_laden": 2100, "lateral_area_ballast": 2800
    }
  },
  "calibration": {
    "calibrated": true,
    "factors": {"calm_water": 1.12, "wind": 0.95, "waves": 1.08, "sfoc_factor": 1.03},
    "calibrated_at": "2026-02-15T10:30:00Z",
    "num_reports_used": 45, "calibration_error_mt": 0.82, "days_since_drydock": 180
  },
  "wave_method": "stawave1",
  "computed": {
    "optimal_speed_laden_kts": 11.5,
    "optimal_speed_ballast_kts": 12.0
  }
}</code></pre>
                </div>

                <div class="endpoint">
                    <span class="endpoint-method method-get">GET</span>
                    <span class="endpoint-path">/api/vessel/fuel-scenarios</span>
                    <p class="endpoint-description">Returns fuel consumption scenarios computed from the real physics model with current calibration. Replaces hardcoded frontend estimates with server-side calculations using VesselModel.</p>
                    <p><strong>Response:</strong></p>
                    <pre><code>{
  "scenarios": [
    {"name": "Calm Water (Laden)", "conditions": "13.0 kts, no wind/waves", "fuel_mt": 24.5, "power_kw": 4200},
    {"name": "Head Wind (Laden)", "conditions": "13.0 kts, 20 kt head wind", "fuel_mt": 28.1, "power_kw": 4800},
    {"name": "Rough Seas (Laden)", "conditions": "13.0 kts, 3m waves", "fuel_mt": 30.3, "power_kw": 5200},
    {"name": "Calm Water (Ballast)", "conditions": "13.0 kts, no wind/waves", "fuel_mt": 22.8, "power_kw": 3900}
  ]
}</code></pre>
                </div>
                </section>

                <div class="endpoint">
                    <span class="endpoint-method method-post">POST</span>
                    <span class="endpoint-path">/api/compliance/cii</span>
                    <p class="endpoint-description">Calculate the IMO CII rating for a completed or planned voyage.</p>
                    <p><strong>Request Body:</strong></p>
                    <pre><code>{
  "total_fuel_mt": 285.3,
  "fuel_type": "VLSFO",
  "distance_nm": 5120,
  "dwt": 49000,
  "year": 2026
}</code></pre>
                    <p><strong>Response:</strong></p>
                    <pre><code>{
  "attained_cii": 4.82,
  "reference_cii": 5.97,
  "required_cii": 5.31,
  "reduction_factor": 11,
  "rating": "B",
  "boundaries": {
    "A_upper": 4.57,
    "B_upper": 4.99,
    "C_upper": 5.63,
    "D_upper": 6.27
  }
}</code></pre>
                </div>
            </section>

            <!-- ============================================================ -->
            <!-- ENGINE LOG API (v0.0.8) -->
            <!-- ============================================================ -->
            <section id="engine-log-api">
                <h2>Engine Log API (v0.0.8)</h2>

                <p>
                    The Engine Log API enables upload and analysis of engine performance data from CSV or Excel files.
                    It provides 5 KPIs (average SFOC, fuel efficiency, load distribution, power utilization, speed-consumption
                    ratio), 6 interactive charts, and a calibration bridge that derives hull and SFOC correction factors
                    from actual operational data.
                </p>

                <div class="endpoint">
                    <span class="endpoint-method method-post">POST</span>
                    <span class="endpoint-path">/api/engine-log/upload</span>
                    <p class="endpoint-description">Upload engine log data from CSV or Excel file. Accepts up to 5,000 entries per batch. Columns are mapped automatically (speed, fuel consumption, power, wind, waves, etc.).</p>
                    <p><strong>Request Body:</strong> Multipart form data with CSV or Excel file.</p>
                    <p><strong>Response:</strong></p>
                    <pre><code>{
  "batch_id": "01JMXYZ...",
  "entries_count": 342,
  "date_range": ["2025-11-15", "2026-01-20"],
  "columns_mapped": ["speed_kts", "fuel_mt_day", "power_kw", "wind_speed_kts", "wave_height_m"]
}</code></pre>
                </div>

                <div class="endpoint">
                    <span class="endpoint-method method-get">GET</span>
                    <span class="endpoint-path">/api/engine-log/entries</span>
                    <p class="endpoint-description">Retrieve engine log entries with optional filtering by date range, loading condition, and batch ID. Returns up to 5,000 entries. Shared filters apply across Entries, Analytics, and Performance tabs.</p>
                </div>

                <div class="endpoint">
                    <span class="endpoint-method method-get">GET</span>
                    <span class="endpoint-path">/api/engine-log/summary</span>
                    <p class="endpoint-description">Returns aggregated KPIs and chart data for the current engine log dataset: average SFOC, fuel efficiency index, load distribution histogram, power utilization, and speed-consumption curve.</p>
                </div>

                <div class="endpoint">
                    <span class="endpoint-method method-post">POST</span>
                    <span class="endpoint-path">/api/engine-log/calibrate</span>
                    <p class="endpoint-description">Run calibration optimization against the uploaded engine log data. Derives calibration factors (<code>calm_water</code>, <code>wind</code>, <code>waves</code>, <code>sfoc_factor</code>) by minimizing the RMSE between the physics model predictions and actual reported fuel consumption.</p>
                    <p><strong>Response:</strong></p>
                    <pre><code>{
  "calibration_factors": {
    "calm_water": 1.08,
    "wind": 0.97,
    "waves": 1.05,
    "sfoc_factor": 1.02
  },
  "rmse_before": 4.12,
  "rmse_after": 1.56,
  "improvement_pct": 62.1,
  "data_points": 342
}</code></pre>
                </div>

                <div class="endpoint">
                    <span class="endpoint-method method-delete">DELETE</span>
                    <span class="endpoint-path">/api/engine-log/batch/{batch_id}</span>
                    <p class="endpoint-description">Delete an uploaded engine log batch and all associated entries.</p>
                </div>
            </section>

            <!-- ============================================================ -->
            <!-- WEATHER DATABASE -->
            <!-- ============================================================ -->
            <section id="weather-database">
                <h2>Weather Database Architecture</h2>

                <p>
                    WindMar stores weather grids as compressed blobs in PostgreSQL. Since v0.0.8, the ingestion model
                    is <strong>user-triggered</strong>: the user clicks a per-layer <em>Resync</em> button to fetch
                    fresh data for the current viewport, replacing the earlier 6-hourly background loop. This
                    eliminates idle network traffic and gives the user explicit control over when data is refreshed.
                    Pre-fetched grids still eliminate the 30&ndash;60 second CMEMS/GFS download latency during
                    route calculations, reducing optimization time from minutes to seconds.
                </p>

                <h3>Database Schema</h3>
                <p>Two tables manage the weather grid lifecycle:</p>

                <table>
                    <thead>
                        <tr><th>Table</th><th>Purpose</th><th>Key Columns</th></tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>weather_forecast_runs</code></td>
                            <td>Tracks ingestion runs per source</td>
                            <td>source, run_time, status, forecast_hours[]</td>
                        </tr>
                        <tr>
                            <td><code>weather_grid_data</code></td>
                            <td>Compressed grid blobs per forecast hour</td>
                            <td>run_id, forecast_hour, parameter, lats/lons/data (BYTEA)</td>
                        </tr>
                    </tbody>
                </table>

                <h3>Compression</h3>
                <p>
                    Each grid is stored as a zlib-compressed float32 numpy array. A global 0.5&deg; grid
                    (341 &times; 721 = ~246K points) compresses to ~200&ndash;400 KB per parameter per forecast hour.
                    Total storage per ingestion cycle: 7 parameters &times; 41 hours &times; ~300 KB &asymp; 86 MB.
                </p>

                <h3>Provider Fallback Chain</h3>
                <p>
                    Weather data is resolved through a multi-tier fallback chain. Each tier is tried in order;
                    the first successful response is used:
                </p>
                <ol>
                    <li><strong>Redis shared cache</strong> &mdash; cross-worker, 15-minute TTL</li>
                    <li><strong>PostgreSQL pre-ingested grids</strong> &mdash; latest complete forecast run</li>
                    <li><strong>Live CMEMS/GFS download</strong> &mdash; direct API call (30&ndash;60s)</li>
                    <li><strong>Synthetic data</strong> &mdash; deterministic test/demo fallback</li>
                </ol>

                <h3>Ingestion Model (v0.0.8: User-Triggered)</h3>
                <p>
                    Since v0.0.8, weather ingestion is <strong>user-triggered per layer</strong> via
                    <code>POST /api/weather/{layer}/resync</code>. Each layer is fetched independently
                    for the current map viewport (capped at 40&deg;&times;60&deg; CMEMS bbox). The data
                    sources are:
                </p>
                <ul>
                    <li><strong>GFS wind</strong> &mdash; 41 forecast hours (f000&ndash;f120, 3-hourly) from NOAA NOMADS with 2s rate limiting</li>
                    <li><strong>CMEMS waves</strong> &mdash; significant wave height, period, direction (swell + wind-wave decomposition)</li>
                    <li><strong>CMEMS currents</strong> &mdash; U/V ocean current components</li>
                    <li><strong>CMEMS ice</strong> &mdash; sea ice concentration from Arctic/Antarctic physics models</li>
                    <li><strong>CMEMS SST</strong> &mdash; sea surface temperature (<code>copernicusmarine.subset()</code> with 6&times; subsampling)</li>
                    <li><strong>CMEMS visibility</strong> &mdash; meteorological visibility from atmospheric model</li>
                    <li><strong>CMEMS swell</strong> &mdash; swell-only component decomposed from total wave field</li>
                </ul>
                <p>
                    Grid subsampling (&le;500 points per axis) prevents oversized responses. Runs are isolated
                    per source: a wave resync does not affect wind data. Older runs are superseded via deferred
                    cleanup after the new run completes. When DB wind grids are unavailable (e.g. first startup),
                    a live GFS snapshot is fetched and injected into the temporal provider so that wind resistance
                    is always included in route calculations.
                </p>

                <div class="alert info">
                    <i class="fas fa-info-circle"></i>
                    <strong>Multi-timestep forecasts</strong> &mdash; The ingestion service stores wave forecasts at
                    0&ndash;120h (3-hourly = 41 steps). The Monte Carlo simulator uses these time-varying conditions
                    along the voyage. Forecast frames for all 7 layers are served to the frontend for timeline playback.
                </div>

                <h3>Visualization Pipeline</h3>
                <p>
                    The frontend presents 7 weather layers, each with a dedicated rendering pipeline from database to map overlay:
                </p>
                <table>
                    <thead>
                        <tr><th>Layer</th><th>Data Source</th><th>API Endpoint</th><th>Renderer</th><th>Color Ramp</th></tr>
                    </thead>
                    <tbody>
                        <tr><td>Wind</td><td>GFS (NOAA)</td><td><code>/api/weather/wind</code> + <code>/wind/velocity</code></td><td>WeatherGridLayer + VelocityParticleLayer</td><td>WMO Beaufort scale</td></tr>
                        <tr><td>Waves</td><td>CMEMS</td><td><code>/api/weather/waves</code></td><td>WeatherGridLayer + WaveCrestOverlay</td><td>Blue&ndash;yellow&ndash;red (0&ndash;8m)</td></tr>
                        <tr><td>Currents</td><td>CMEMS</td><td><code>/api/weather/currents/velocity</code></td><td>VelocityParticleLayer</td><td>Particle speed coloring</td></tr>
                        <tr><td>Swell</td><td>CMEMS</td><td><code>/api/weather/forecast/wave/frames</code></td><td>WeatherGridLayer</td><td>Blue&ndash;purple (0&ndash;6m)</td></tr>
                        <tr><td>SST</td><td>CMEMS</td><td><code>/api/weather/forecast/sst/frames</code></td><td>WeatherGridLayer</td><td>Cold blue &rarr; warm red (&minus;2&ndash;32&deg;C)</td></tr>
                        <tr><td>Visibility</td><td>CMEMS</td><td><code>/api/weather/forecast/visibility/frames</code></td><td>WeatherGridLayer</td><td>Red&ndash;yellow&ndash;green (0&ndash;30km)</td></tr>
                        <tr><td>Ice</td><td>CMEMS</td><td><code>/api/weather/forecast/ice/frames</code></td><td>WeatherGridLayer</td><td>White&ndash;blue (0&ndash;100%)</td></tr>
                    </tbody>
                </table>
                <p>
                    <strong>Rendering flow:</strong> API serves compressed grid data &rarr; frontend decompresses into lat/lon arrays &rarr;
                    <code>WeatherGridLayer</code> draws colored cells on a Leaflet canvas overlay, with WMO-standard color ramps per field.
                    Wind and currents additionally use <code>VelocityParticleLayer</code> for animated particle flow.
                    The <code>ForecastTimeline</code> component manages frame playback across all layers with play/pause, speed control,
                    and a scrubber bar showing rich date labels. Each layer type fetches its own forecast frames independently.
                </p>

                <h3>Two-Mode Architecture (v0.0.7)</h3>
                <p>
                    The frontend uses a mode toggle in the header to switch between two workflows:
                </p>
                <ul>
                    <li><strong>Weather mode</strong> &mdash; Full-screen map with all 7 weather overlays. The user pans freely;
                        weather data loads for the visible viewport. Forecast timeline, layer selector, and legend are visible.
                        No route analysis panels are shown.</li>
                    <li><strong>Analysis mode</strong> &mdash; A left panel (320px) appears with route import (RTZ/JSON),
                        departure time picker, voyage calculation, optimization comparison (6 route variants), and
                        Monte Carlo simulation. Weather overlays are hidden to keep the map focused on the route.
                        A &ldquo;View Full Analysis&rdquo; link opens the <code>/analysis</code> page with a per-waypoint
                        passage plan table showing ETA, SOG, wind, waves, current, fuel, and data source badges.</li>
                </ul>

                <h3>DbWeatherProvider</h3>
                <p>
                    The <code>DbWeatherProvider</code> class reads compressed grids from PostgreSQL, decompresses
                    them into numpy arrays, crops to the requested bounding box, and returns <code>WeatherData</code>
                    objects. It selects the best available forecast hour for time-specific queries using nearest-neighbour
                    matching against available forecast hours.
                </p>

                <h3>Performance</h3>
                <table>
                    <thead>
                        <tr><th>Operation</th><th>Before (live)</th><th>After (DB)</th></tr>
                    </thead>
                    <tbody>
                        <tr><td>Route optimization (10-leg)</td><td>90&ndash;180s</td><td>2&ndash;5s</td></tr>
                        <tr><td>Voyage calculation</td><td>30&ndash;60s</td><td>&lt; 1s</td></tr>
                        <tr><td>Monte Carlo (100 sims)</td><td>N/A</td><td>&lt; 500ms</td></tr>
                    </tbody>
                </table>
            </section>

            <!-- ============================================================ -->
            <!-- FORECAST TIMELINE -->
            <!-- ============================================================ -->
            <section id="forecast-timeline">
                <h2>Forecast Timeline</h2>

                <p>
                    The Forecast Timeline allows the user to animate weather data across all 41 forecast
                    hours (0&ndash;120h, 3-hourly) for wind, waves, currents, swell, SST, and visibility,
                    or across 10 daily steps (0&ndash;216h) for ice concentration. The timeline provides
                    play/pause, speed control (1&times;/2&times;/4&times;), and a scrubber bar that
                    shows date labels aligned with the model run time.
                </p>

                <div class="alert info">
                    <i class="fas fa-info-circle"></i>
                    <strong>Local-first architecture</strong> &mdash; WindMar runs entirely on a local machine.
                    Unlike cloud services such as Windy.com that serve pre-rendered tiles from a global CDN,
                    WindMar fetches raw forecast data on demand, stores it in a local PostgreSQL database,
                    and renders overlays client-side in the browser. This design gives full data ownership
                    and offline capability, but imposes memory and bandwidth constraints that affect
                    the timeline experience.
                </div>

                <h3>Data Flow</h3>
                <p>
                    All 7 weather layers use the same direct-load pattern. There is no background
                    prefetching or polling loop.
                </p>
                <ol>
                    <li>User activates a weather layer (e.g., Wind) and clicks the Timeline button</li>
                    <li>The frontend calls the layer&rsquo;s <code>/frames</code> endpoint with the
                        current viewport bounds, padded to 10&deg; grid cell edges</li>
                    <li>The backend checks the file cache (<code>/tmp/windmar_cache/</code>). On cache miss,
                        it rebuilds all forecast frames from PostgreSQL in a single pass (~3&ndash;50s
                        depending on viewport size)</li>
                    <li>The complete multi-frame JSON response is loaded into browser memory</li>
                    <li>The slider auto-positions to the forecast hour nearest to the current time</li>
                    <li>Frame switching during playback and scrubbing is instant &mdash; all data is client-side</li>
                </ol>

                <h3>Viewport Bounds and Capping</h3>
                <p>
                    When the timeline opens, the visible map viewport is captured and padded outward to
                    the nearest 10&deg; grid cell boundaries. A <strong>maximum span of 120&deg; per axis</strong>
                    is enforced to prevent the browser from receiving responses that exceed its memory capacity.
                </p>
                <p>
                    Pan and zoom actions after the timeline is open do <strong>not</strong> trigger a re-fetch.
                    The data overlay remains fixed to the bounds captured at load time. If the user pans
                    beyond those bounds, the heatmap will be truncated at the grid edges. To load data for a
                    different region:
                </p>
                <ol>
                    <li>Navigate the map to the desired region</li>
                    <li>Click <strong>Resync</strong> to re-ingest forecast data for the new viewport</li>
                    <li>Re-open the Timeline &mdash; it will capture the new bounds</li>
                </ol>

                <h3>Browser Memory Constraints</h3>
                <p>
                    The entire forecast dataset (all timesteps, all grid points) is held in the JavaScript
                    heap simultaneously. For wind data at GFS 0.25&deg; resolution, the response size
                    scales with the viewport area:
                </p>
                <table>
                    <thead>
                        <tr><th>Viewport Span</th><th>Grid Points (per component)</th><th>JSON Response (41 frames)</th><th>Browser Behaviour</th></tr>
                    </thead>
                    <tbody>
                        <tr><td>30&deg; &times; 55&deg; (e.g., Europe)</td><td>~26K</td><td>~24 MB</td><td>Loads in ~3s, smooth animation</td></tr>
                        <tr><td>80&deg; &times; 80&deg; (e.g., Indian Ocean)</td><td>~103K</td><td>~129 MB</td><td>Loads in ~50s, smooth animation</td></tr>
                        <tr><td>120&deg; &times; 120&deg; (maximum cap)</td><td>~231K</td><td>~290 MB (est.)</td><td>Near browser memory limit</td></tr>
                    </tbody>
                </table>
                <p>
                    Responses above ~300 MB risk crashing the browser tab. The 120&deg; cap is a pragmatic
                    trade-off between coverage area and stability. Users needing data for a large ocean basin
                    should zoom to the region of interest before opening the timeline.
                </p>

                <h3>Wind Particle Animation</h3>
                <p>
                    The wind layer renders two overlapping visualizations: a colour-mapped heatmap
                    (WMO Beaufort scale) and animated wind particles (leaflet-velocity). The heatmap
                    is clipped to the data grid bounds, but the particle layer may extrapolate slightly
                    beyond the grid edges. This is a cosmetic artifact of the particle rendering engine
                    and does not affect data accuracy.
                </p>

                <h3>Cache Architecture</h3>
                <p>
                    Frame data is cached at three levels to minimise redundant computation:
                </p>
                <table>
                    <thead>
                        <tr><th>Cache Tier</th><th>Scope</th><th>TTL</th><th>Effect</th></tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Client-side (React ref)</td>
                            <td>Per browser session</td>
                            <td>Until page reload or layer change</td>
                            <td>Instant restore when re-opening the timeline</td>
                        </tr>
                        <tr>
                            <td>File cache (<code>/tmp/windmar_cache/</code>)</td>
                            <td>Per viewport bounds, per layer</td>
                            <td>12 hours (cleaned on resync)</td>
                            <td>Skips DB rebuild on repeated requests</td>
                        </tr>
                        <tr>
                            <td>PostgreSQL</td>
                            <td>Per source, global grid</td>
                            <td>Until superseded by newer run</td>
                            <td>Authoritative store; file cache rebuilt from here</td>
                        </tr>
                    </tbody>
                </table>
                <p>
                    A Resync invalidates the client-side and file caches, forcing a fresh rebuild from
                    the newly ingested PostgreSQL data on the next timeline open.
                </p>
            </section>

            <!-- ============================================================ -->
            <!-- MONTE CARLO SIMULATION -->
            <!-- ============================================================ -->
            <section id="monte-carlo">
                <h2>Monte Carlo Simulation</h2>

                <p>
                    WindMar includes a parametric Monte Carlo simulator that produces P10/P50/P90 confidence intervals
                    for ETA, fuel consumption, and voyage time. The simulator accounts for weather forecast uncertainty
                    by applying temporally correlated perturbations to base weather conditions along the route.
                </p>

                <div class="alert info">
                    <i class="fas fa-info-circle"></i>
                    <strong>For the full mathematical framework</strong>, see the
                    <a href="monte-carlo.html">Parametric Monte Carlo Simulation</a> technical article with
                    academic references.
                </div>

                <h3>Architecture</h3>
                <p>The simulation proceeds in four stages:</p>
                <ol>
                    <li><strong>Route timeline</strong> &mdash; The voyage is divided into up to 100 evenly-spaced
                        time slices (~1 slice per 1.2 hours). Each slice has a timestamp and interpolated
                        (lat, lon) position along the rhumb-line route.</li>
                    <li><strong>Weather pre-fetch</strong> &mdash; Base weather (wind, wave, current) is loaded
                        for all slices. Wave data comes from multi-timestep DB grids (forecast hours 0&ndash;120h),
                        currents from a single DB snapshot, and wind from the pre-built GridWeatherProvider.</li>
                    <li><strong>Correlated perturbation</strong> &mdash; For each of N simulations, temporally
                        correlated random factors are generated via Cholesky decomposition of an exponential
                        correlation matrix. These factors perturb wind speed, wave height, current speed,
                        and directions.</li>
                    <li><strong>Voyage calculation</strong> &mdash; Each simulation runs a full voyage calculation
                        with the perturbed weather provider. Results are collected and percentiles computed.</li>
                </ol>

                <h3>Perturbation Model</h3>
                <table>
                    <thead>
                        <tr><th>Parameter</th><th>Distribution</th><th>&sigma;</th><th>Correlation</th></tr>
                    </thead>
                    <tbody>
                        <tr><td>Wind speed</td><td>Log-normal, E[f]=1</td><td>0.35</td><td>Temporal (Cholesky)</td></tr>
                        <tr><td>Wave height</td><td>Log-normal, E[f]=1</td><td>0.20</td><td>70% with wind + 30% independent</td></tr>
                        <tr><td>Current speed</td><td>Log-normal, E[f]=1</td><td>0.15</td><td>Independent temporal</td></tr>
                        <tr><td>Directions</td><td>Gaussian offset</td><td>15&deg;</td><td>Temporal (Cholesky)</td></tr>
                    </tbody>
                </table>

                <h3>Temporal Correlation</h3>

                <div class="formula-block">
                    <div class="formula-title">Exponential Correlation Matrix</div>
                    \[\text{cov}(i, j) = \exp\!\left(-\frac{|t_i - t_j|}{\tau}\right)\]
                    <div class="formula-where">
                        <p>where \(t \in [0, 1]\) is normalised time along the voyage, \(\tau = 0.3\) (correlation length as fraction of voyage duration)</p>
                    </div>
                    <p>Cholesky decomposition:</p>
                    \[L \cdot L^T = \text{cov}\]
                    <p>Correlated normals:</p>
                    \[\mathbf{z} = L \cdot \boldsymbol{\varepsilon}, \quad \boldsymbol{\varepsilon} \sim \mathcal{N}(\mathbf{0}, I)\]
                </div>

                <p>
                    The exponential kernel ensures that weather perturbations at nearby time slices are
                    strongly correlated (a storm at hour 12 implies bad weather at hour 15), while distant
                    slices are nearly independent. The correlation length &tau; = 0.3 corresponds to ~1.5 days
                    for a 5-day voyage.
                </p>

                <h3>Wind&ndash;Wave Coupling</h3>
                <p>
                    Wave height perturbations are 70% correlated with wind perturbations, reflecting the
                    physical relationship between wind forcing and sea state:
                </p>
                <div class="formula-block">
                    <div class="formula-title">Wind&ndash;Wave Coupling</div>
                    \[z_{\text{wave}} = 0.7 \cdot z_{\text{wind}} + \sqrt{1 - 0.7^2} \cdot z_{\text{wave,indep}}\]
                    \[f_{\text{wave}} = \exp\!\left(\sigma_{\text{wave}} \cdot z_{\text{wave}} - 0.5 \cdot \sigma_{\text{wave}}^2\right)\]
                </div>

                <h3>API Usage</h3>
                <pre><code>POST /api/voyage/monte-carlo
{
  "waypoints": [
    {"lat": 51.95, "lon": 4.05, "name": "Rotterdam"},
    {"lat": 37.23, "lon": 15.22, "name": "Augusta"}
  ],
  "calm_speed_kts": 13.0,
  "is_laden": true,
  "departure_time": "2026-02-10T06:00:00Z",
  "n_simulations": 100
}

Response:
{
  "n_simulations": 100,
  "eta_p10": "2026-02-14T13:22:00Z",
  "eta_p50": "2026-02-14T14:55:00Z",
  "eta_p90": "2026-02-14T16:28:00Z",
  "fuel_p10": 285.4,
  "fuel_p50": 302.1,
  "fuel_p90": 321.8,
  "time_p10": 103.4,
  "time_p50": 104.9,
  "time_p90": 106.5,
  "computation_time_ms": 399.2
}</code></pre>

                <h3>References</h3>
                <ul>
                    <li>Dickson, T., Farr, H., Sear, D., and Blake, J. (2019). &ldquo;Uncertainty in marine weather routing.&rdquo; <em>arXiv:1901.03840</em></li>
                    <li>Aijjou, A.E. et al. (2021). &ldquo;A Comprehensive Approach to Account for Weather Uncertainties in Ship Route Optimization.&rdquo; <em>J. Mar. Sci. Eng.</em> 9(12):1434</li>
                </ul>
            </section>

            <!-- ============================================================ -->
            <!-- MODEL VALIDATION -->
            <!-- ============================================================ -->
            <section id="model-validation">
                <h2>Model Validation</h2>

                <p>
                    WindMar includes a comprehensive test suite that validates physical models against expected
                    behaviors, empirical relationships, and boundary conditions. Tests are structured to verify
                    both individual model components and the integrated optimization pipeline.
                </p>

                <h3>Unit Tests</h3>
                <p>The following physical constraints are validated:</p>

                <ul>
                    <li><strong>Resistance increases with speed</strong> &mdash; Total calm water resistance at 16 kts exceeds resistance at 12 kts for both laden and ballast conditions</li>
                    <li><strong>Laden uses more fuel than ballast</strong> &mdash; At the same speed, the laden condition produces higher calm water resistance due to greater displacement and wetted surface</li>
                    <li><strong>Weather increases fuel consumption</strong> &mdash; Total fuel with wind and waves always exceeds calm water fuel for the same speed and distance</li>
                    <li><strong>SFOC optimal at 75-85% load</strong> &mdash; SFOC at 80% load is lower than SFOC at 50% load and lower than SFOC at 100% load</li>
                    <li><strong>Head wind worse than following wind</strong> &mdash; Wind resistance at 0 degrees (head wind) exceeds wind resistance at 180 degrees (following wind)</li>
                    <li><strong>A* finds path avoiding land</strong> &mdash; No waypoint in the optimized path falls on a land cell as classified by global-land-mask</li>
                    <li><strong>Safety constraints block dangerous routes</strong> &mdash; When dangerous conditions exist on the direct path, the optimizer produces a detour that avoids them</li>
                    <li><strong>Zone exclusions force detours</strong> &mdash; An exclusion zone on the direct path forces the optimizer to route around it, increasing total distance</li>
                </ul>

                <h3>Integration Tests</h3>
                <ul>
                    <li><strong>Full optimization flow</strong> &mdash; End-to-end test from route request through weather fetch, A* search, speed optimization, and CII calculation</li>
                    <li><strong>API endpoint validation</strong> &mdash; All REST endpoints return correct HTTP status codes, response schemas, and handle invalid input gracefully</li>
                    <li><strong>Weather provider fallback</strong> &mdash; Synthetic weather provider produces consistent results when Copernicus credentials are not available</li>
                </ul>

                <h3>Physical Constants</h3>

                <table>
                    <thead>
                        <tr>
                            <th>Constant</th>
                            <th>Symbol</th>
                            <th>Value</th>
                            <th>Unit</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td>Seawater density</td><td>&rho;_sw</td><td>1025</td><td>kg/m&sup3;</td></tr>
                        <tr><td>Seawater kinematic viscosity</td><td>&nu;_sw</td><td>1.19 &times; 10<sup>-6</sup></td><td>m&sup2;/s</td></tr>
                        <tr><td>Air density</td><td>&rho;_air</td><td>1.225</td><td>kg/m&sup3;</td></tr>
                        <tr><td>Gravitational acceleration</td><td>g</td><td>9.81</td><td>m/s&sup2;</td></tr>
                        <tr><td>Knot to m/s conversion</td><td>&mdash;</td><td>0.5144</td><td>m/s per knot</td></tr>
                    </tbody>
                </table>

                <div class="alert success">
                    <strong><i class="fas fa-check-circle"></i> Validation Status</strong><br>
                    All physical models produce results consistent with empirical data for MR product tankers.
                    The Holtrop-Mennen calm water resistance has been validated against published resistance data
                    for vessels of similar dimensions and hull form. SFOC curves match manufacturer specifications
                    for two-stroke marine diesel engines in the 8,000-10,000 kW range. Seakeeping predictions
                    show correct trends for roll, pitch, and acceleration as functions of wave height and encounter
                    angle.
                </div>
            </section>

            <!-- ============================================================ -->
            <!-- CALIBRATION -->
            <!-- ============================================================ -->
            <section id="calibration">
                <h2>Calibration</h2>

                <p>
                    Calibration adjusts the physics model parameters to match observed vessel performance from
                    noon report data. This accounts for hull fouling, propeller degradation, and other vessel-specific
                    factors that cause the default model to deviate from actual fuel consumption.
                </p>

                <h3>Noon Report Data Format</h3>
                <p>
                    Calibration accepts an Excel file (.xlsx) with the following columns. Each row represents
                    one noon-to-noon reporting period (approximately 24 hours).
                </p>

                <table>
                    <thead>
                        <tr>
                            <th>Column</th>
                            <th>Unit</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td>Speed</td><td>knots</td><td>Average speed over ground</td></tr>
                        <tr><td>Distance</td><td>nm</td><td>Distance traveled in reporting period</td></tr>
                        <tr><td>Fuel</td><td>MT</td><td>Total fuel consumed in reporting period</td></tr>
                        <tr><td>Wind</td><td>Beaufort</td><td>Average wind force (Beaufort scale 0-12)</td></tr>
                        <tr><td>Waves</td><td>m</td><td>Average significant wave height</td></tr>
                        <tr><td>Draft</td><td>m</td><td>Mean draft (used to determine laden/ballast)</td></tr>
                        <tr><td>Temperature</td><td>&deg;C</td><td>Seawater temperature (for viscosity correction)</td></tr>
                    </tbody>
                </table>

                <h3>Optimization Method</h3>
                <p>
                    Calibration uses <code>scipy.optimize.minimize</code> with the Nelder-Mead simplex algorithm
                    to find the calibration factors that minimize the root mean square error (RMSE) between predicted
                    and actual fuel consumption across all noon report entries.
                </p>

                <div class="formula-block">
                    <div class="formula-title">Calibration Objective Function</div>
                    <p>Objective: minimize RMSE</p>
                    \[\text{RMSE} = \sqrt{\frac{1}{N} \sum_{i=1}^{N} \bigl(\text{fuel}_{\text{predicted},i} - \text{fuel}_{\text{actual},i}\bigr)^2}\]
                    <p>Predicted fuel for each reporting period:</p>
                    \[R_{\text{total}} = k_{\text{calm}} \cdot R_{\text{calm}} + k_{\text{wind}} \cdot R_{\text{wind}} + k_{\text{wave}} \cdot R_{\text{wave}}\]
                    \[\text{fuel}_{\text{predicted}} = f(R_{\text{total}},\; V,\; d,\; \text{SFOC})\]
                    <div class="formula-where">
                        <p>Calibration factors (decision variables):</p>
                        <ul>
                            <li>\(k_{\text{calm}} \in [0.5, 2.0]\) (calm water resistance multiplier)</li>
                            <li>\(k_{\text{wind}} \in [0.5, 2.0]\) (wind resistance multiplier)</li>
                            <li>\(k_{\text{wave}} \in [0.5, 2.0]\) (wave resistance multiplier)</li>
                        </ul>
                        <p>Initial values: \(k_{\text{calm}} = k_{\text{wind}} = k_{\text{wave}} = 1.0\)</p>
                        <p>Method: Nelder-Mead (derivative-free simplex)</p>
                    </div>
                </div>

                <h3>Interpretation of Calibration Factors</h3>
                <ul>
                    <li><strong>k_calm &gt; 1.0</strong> &mdash; Hull roughness or fouling increasing skin friction beyond the clean-hull model prediction</li>
                    <li><strong>k_calm &lt; 1.0</strong> &mdash; Hull is cleaner than the model assumes (e.g., recent dry-docking)</li>
                    <li><strong>k_wind &gt; 1.0</strong> &mdash; Above-water structure presents more windage than the default areas suggest</li>
                    <li><strong>k_wave &gt; 1.0</strong> &mdash; Vessel is more sensitive to waves than the Kwon formula predicts (e.g., bluff bow form)</li>
                </ul>

                <p>
                    Factors are bounded to [0.5, 2.0] to prevent physically unreasonable corrections. A factor
                    outside this range indicates either bad input data or a fundamental mismatch between the vessel
                    and the default model parameters, requiring manual review of the vessel specifications.
                </p>
            </section>

            <!-- ============================================================ -->
            <!-- TECHNICAL ARTICLES INDEX -->
            <!-- ============================================================ -->
            <!-- ============================================================ -->
            <!-- GALLERY -->
            <!-- ============================================================ -->
            <section id="gallery">
                <h2>Screenshots</h2>
                <p>
                    Screenshots from the WindMar application showing the main features and capabilities.
                    Click any image to view full size.
                </p>

                <h3>Weather Overlays</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin: 1.5rem 0;">
                    <figure style="margin: 0;">
                        <a href="assets/img/screenshots/weather-wind.png" target="_blank">
                            <img src="assets/img/screenshots/weather-wind.png" alt="Wind forecast" style="width: 100%; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 4px 12px rgba(0,0,0,0.3);">
                        </a>
                        <figcaption style="text-align: center; font-size: 0.85rem; color: #6b7280; margin-top: 0.5rem;">
                            <strong>Wind</strong> &mdash; GFS particle animation with 5-day forecast timeline
                        </figcaption>
                    </figure>
                    <figure style="margin: 0;">
                        <a href="assets/img/screenshots/weather-waves.png" target="_blank">
                            <img src="assets/img/screenshots/weather-waves.png" alt="Wave height overlay" style="width: 100%; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 4px 12px rgba(0,0,0,0.3);">
                        </a>
                        <figcaption style="text-align: center; font-size: 0.85rem; color: #6b7280; margin-top: 0.5rem;">
                            <strong>Waves</strong> &mdash; Significant wave height from CMEMS with WMO color ramp
                        </figcaption>
                    </figure>
                    <figure style="margin: 0;">
                        <a href="assets/img/screenshots/weather-swell.png" target="_blank">
                            <img src="assets/img/screenshots/weather-swell.png" alt="Swell overlay" style="width: 100%; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 4px 12px rgba(0,0,0,0.3);">
                        </a>
                        <figcaption style="text-align: center; font-size: 0.85rem; color: #6b7280; margin-top: 0.5rem;">
                            <strong>Swell</strong> &mdash; Swell height and direction with crest rendering
                        </figcaption>
                    </figure>
                    <figure style="margin: 0;">
                        <a href="assets/img/screenshots/weather-currents.png" target="_blank">
                            <img src="assets/img/screenshots/weather-currents.png" alt="Ocean currents" style="width: 100%; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 4px 12px rgba(0,0,0,0.3);">
                        </a>
                        <figcaption style="text-align: center; font-size: 0.85rem; color: #6b7280; margin-top: 0.5rem;">
                            <strong>Currents</strong> &mdash; Ocean current velocity from CMEMS global physics model
                        </figcaption>
                    </figure>
                    <figure style="margin: 0;">
                        <a href="assets/img/screenshots/weather-visibility.png" target="_blank">
                            <img src="assets/img/screenshots/weather-visibility.png" alt="Visibility overlay" style="width: 100%; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 4px 12px rgba(0,0,0,0.3);">
                        </a>
                        <figcaption style="text-align: center; font-size: 0.85rem; color: #6b7280; margin-top: 0.5rem;">
                            <strong>Visibility</strong> &mdash; Atmospheric visibility field
                        </figcaption>
                    </figure>
                    <figure style="margin: 0;">
                        <a href="assets/img/screenshots/weather-ice.png" target="_blank">
                            <img src="assets/img/screenshots/weather-ice.png" alt="Sea ice concentration" style="width: 100%; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 4px 12px rgba(0,0,0,0.3);">
                        </a>
                        <figcaption style="text-align: center; font-size: 0.85rem; color: #6b7280; margin-top: 0.5rem;">
                            <strong>Sea Ice</strong> &mdash; Arctic ice concentration from CMEMS
                        </figcaption>
                    </figure>
                </div>

                <h3>Baltic Ice Animation</h3>
                <div style="margin: 1.5rem 0;">
                    <video controls autoplay muted loop style="width: 100%; max-width: 800px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 4px 12px rgba(0,0,0,0.3);">
                        <source src="assets/img/screenshots/baltic-ice-animation.webm" type="video/webm">
                        Your browser does not support the video tag.
                    </video>
                    <p style="font-size: 0.85rem; color: #6b7280; margin-top: 0.5rem;">
                        <strong>Baltic Sea Ice Forecast</strong> &mdash; 5-day ice concentration animation showing ice coverage evolution across forecast timesteps
                    </p>
                </div>

                <h3>Route Optimization</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin: 1.5rem 0;">
                    <figure style="margin: 0;">
                        <a href="assets/img/screenshots/route-portugal-casquets.png" target="_blank">
                            <img src="assets/img/screenshots/route-portugal-casquets.png" alt="Route optimization" style="width: 100%; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 4px 12px rgba(0,0,0,0.3);">
                        </a>
                        <figcaption style="text-align: center; font-size: 0.85rem; color: #6b7280; margin-top: 0.5rem;">
                            <strong>Optimized Routes</strong> &mdash; Weather-optimal routing with A* engine, strait shortcuts, and Pareto front
                        </figcaption>
                    </figure>
                    <figure style="margin: 0;">
                        <a href="assets/img/screenshots/voyage-window.png" target="_blank">
                            <img src="assets/img/screenshots/voyage-window.png" alt="Voyage calculation" style="width: 100%; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 4px 12px rgba(0,0,0,0.3);">
                        </a>
                        <figcaption style="text-align: center; font-size: 0.85rem; color: #6b7280; margin-top: 0.5rem;">
                            <strong>Voyage Calculation</strong> &mdash; Per-leg fuel, speed, ETA breakdown with weather conditions
                        </figcaption>
                    </figure>
                    <figure style="margin: 0;">
                        <a href="assets/img/screenshots/analysis-console.png" target="_blank">
                            <img src="assets/img/screenshots/analysis-console.png" alt="Analysis console" style="width: 100%; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 4px 12px rgba(0,0,0,0.3);">
                        </a>
                        <figcaption style="text-align: center; font-size: 0.85rem; color: #6b7280; margin-top: 0.5rem;">
                            <strong>Analysis Console</strong> &mdash; Route comparison table with fuel, distance, time, and waypoint counts
                        </figcaption>
                    </figure>
                    <figure style="margin: 0;">
                        <a href="assets/img/screenshots/sog-profile.png" target="_blank">
                            <img src="assets/img/screenshots/sog-profile.png" alt="Speed over ground profile" style="width: 100%; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 4px 12px rgba(0,0,0,0.3);">
                        </a>
                        <figcaption style="text-align: center; font-size: 0.85rem; color: #6b7280; margin-top: 0.5rem;">
                            <strong>SOG Profile</strong> &mdash; Speed over ground and cumulative fuel along the optimized route
                        </figcaption>
                    </figure>
                </div>

                <h3>Vessel Performance</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin: 1.5rem 0;">
                    <figure style="margin: 0;">
                        <a href="assets/img/screenshots/vessel-model.png" target="_blank">
                            <img src="assets/img/screenshots/vessel-model.png" alt="Vessel model curves" style="width: 100%; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 4px 12px rgba(0,0,0,0.3);">
                        </a>
                        <figcaption style="text-align: center; font-size: 0.85rem; color: #6b7280; margin-top: 0.5rem;">
                            <strong>Vessel Model</strong> &mdash; Resistance, brake power, SFOC, and fuel curves with calibration factors
                        </figcaption>
                    </figure>
                    <figure style="margin: 0;">
                        <a href="assets/img/screenshots/vessel-specs.png" target="_blank">
                            <img src="assets/img/screenshots/vessel-specs.png" alt="Vessel specifications" style="width: 100%; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 4px 12px rgba(0,0,0,0.3);">
                        </a>
                        <figcaption style="text-align: center; font-size: 0.85rem; color: #6b7280; margin-top: 0.5rem;">
                            <strong>Specifications</strong> &mdash; Configurable vessel parameters persisted in PostgreSQL
                        </figcaption>
                    </figure>
                    <figure style="margin: 0;">
                        <a href="assets/img/screenshots/fuel-analysis.png" target="_blank">
                            <img src="assets/img/screenshots/fuel-analysis.png" alt="Fuel analysis" style="width: 100%; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 4px 12px rgba(0,0,0,0.3);">
                        </a>
                        <figcaption style="text-align: center; font-size: 0.85rem; color: #6b7280; margin-top: 0.5rem;">
                            <strong>Fuel Analysis</strong> &mdash; Physics-based fuel scenarios across loading conditions and weather
                        </figcaption>
                    </figure>
                    <figure style="margin: 0;">
                        <a href="assets/img/screenshots/engine-log-performance.png" target="_blank">
                            <img src="assets/img/screenshots/engine-log-performance.png" alt="Engine log performance" style="width: 100%; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 4px 12px rgba(0,0,0,0.3);">
                        </a>
                        <figcaption style="text-align: center; font-size: 0.85rem; color: #6b7280; margin-top: 0.5rem;">
                            <strong>Performance Predictor</strong> &mdash; Bisection solver for speed at given engine load in weather
                        </figcaption>
                    </figure>
                </div>

                <h3>Engine Log &amp; Compliance</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin: 1.5rem 0;">
                    <figure style="margin: 0;">
                        <a href="assets/img/screenshots/engine-log-entries.png" target="_blank">
                            <img src="assets/img/screenshots/engine-log-entries.png" alt="Engine log entries" style="width: 100%; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 4px 12px rgba(0,0,0,0.3);">
                        </a>
                        <figcaption style="text-align: center; font-size: 0.85rem; color: #6b7280; margin-top: 0.5rem;">
                            <strong>Engine Log Entries</strong> &mdash; Paginated entries browser with event and date filters
                        </figcaption>
                    </figure>
                    <figure style="margin: 0;">
                        <a href="assets/img/screenshots/engine-log-analytics.png" target="_blank">
                            <img src="assets/img/screenshots/engine-log-analytics.png" alt="Engine log analytics" style="width: 100%; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 4px 12px rgba(0,0,0,0.3);">
                        </a>
                        <figcaption style="text-align: center; font-size: 0.85rem; color: #6b7280; margin-top: 0.5rem;">
                            <strong>Analytics Dashboard</strong> &mdash; Speed-power scatter, fuel distributions, SFOC profile, voyage timeline
                        </figcaption>
                    </figure>
                    <figure style="margin: 0;">
                        <a href="assets/img/screenshots/cii-compliance.png" target="_blank">
                            <img src="assets/img/screenshots/cii-compliance.png" alt="CII compliance" style="width: 100%; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 4px 12px rgba(0,0,0,0.3);">
                        </a>
                        <figcaption style="text-align: center; font-size: 0.85rem; color: #6b7280; margin-top: 0.5rem;">
                            <strong>CII Compliance</strong> &mdash; IMO Carbon Intensity rating with multi-year projection
                        </figcaption>
                    </figure>
                    <figure style="margin: 0;">
                        <a href="assets/img/screenshots/regulations.png" target="_blank">
                            <img src="assets/img/screenshots/regulations.png" alt="Regulatory zones" style="width: 100%; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 4px 12px rgba(0,0,0,0.3);">
                        </a>
                        <figcaption style="text-align: center; font-size: 0.85rem; color: #6b7280; margin-top: 0.5rem;">
                            <strong>Regulatory Zones</strong> &mdash; ECA/SECA, TSS, HRA zones with GeoJSON visualization
                        </figcaption>
                    </figure>
                </div>
            </section>

            <!-- ============================================================ -->
            <!-- TECHNICAL ARTICLES -->
            <!-- ============================================================ -->
            <section id="technical-articles">
                <h2>Technical Articles</h2>
                <p>
                    The following peer-reviewed-style articles provide in-depth coverage of WindMar's core subsystems.
                    Each article presents the mathematical foundations, implementation details, and relevant references
                    for a specific domain of the weather routing pipeline.
                </p>

                <div class="feature-grid" style="grid-template-columns: repeat(2, 1fr);">

                    <div class="feature-card">
                        <h4><i class="fas fa-cloud-sun"></i> Weather Data Fields</h4>
                        <ul style="list-style: none; padding: 0; margin: 0 0 1rem 0;">
                            <li>Meteorological and oceanographic parameters: wind (GFS), waves (CMEMS), currents, and ocean masking used in vessel performance prediction.</li>
                        </ul>
                        <a href="weather-fields.html" class="btn btn-secondary" style="padding: 0.4rem 1rem; font-size: 0.85rem;">Read article</a>
                    </div>

                    <div class="feature-card">
                        <h4><i class="fas fa-database"></i> Data Ingestion &amp; Restitution</h4>
                        <ul style="list-style: none; padding: 0; margin: 0 0 1rem 0;">
                            <li>Pipeline architecture from acquisition through compressed PostgreSQL storage to trilinear-interpolated, route-ready weather grids.</li>
                        </ul>
                        <a href="data-pipeline.html" class="btn btn-secondary" style="padding: 0.4rem 1rem; font-size: 0.85rem;">Read article</a>
                    </div>

                    <div class="feature-card">
                        <h4><i class="fas fa-water"></i> Hydrodynamics &amp; RAO</h4>
                        <ul style="list-style: none; padding: 0; margin: 0 0 1rem 0;">
                            <li>Holtrop-Mennen calm-water resistance, STAWAVE-1 added wave resistance, simplified RAO seakeeping, and noon-report calibration.</li>
                        </ul>
                        <a href="hydrodynamics.html" class="btn btn-secondary" style="padding: 0.4rem 1rem; font-size: 0.85rem;">Read article</a>
                    </div>

                    <div class="feature-card">
                        <h4><i class="fas fa-route"></i> A* Pathfinding</h4>
                        <ul style="list-style: none; padding: 0; margin: 0 0 1rem 0;">
                            <li>Adaptation of A* graph search to minimum-fuel ocean routing with physics-based cost evaluation and time-varying weather integration.</li>
                        </ul>
                        <a href="astar-pathfinding.html" class="btn btn-secondary" style="padding: 0.4rem 1rem; font-size: 0.85rem;">Read article</a>
                    </div>

                    <div class="feature-card">
                        <h4><i class="fas fa-cloud-sun-rain"></i> Weather Data Acquisition</h4>
                        <ul style="list-style: none; padding: 0; margin: 0 0 1rem 0;">
                            <li>GFS and ERA5 wind data acquisition, CMEMS wave and current forecasts, and the unified forecast-climatology blending framework.</li>
                        </ul>
                        <a href="weather-data.html" class="btn btn-secondary" style="padding: 0.4rem 1rem; font-size: 0.85rem;">Read article</a>
                    </div>

                    <div class="feature-card">
                        <h4><i class="fas fa-dice"></i> Monte Carlo Simulation</h4>
                        <ul style="list-style: none; padding: 0; margin: 0 0 1rem 0;">
                            <li>Parametric Monte Carlo simulation with temporal weather correlation for voyage uncertainty quantification of fuel and ETA.</li>
                        </ul>
                        <a href="monte-carlo.html" class="btn btn-secondary" style="padding: 0.4rem 1rem; font-size: 0.85rem;">Read article</a>
                    </div>

                    <div class="feature-card">
                        <h4><i class="fas fa-compass"></i> Trois probl&egrave;mes ouverts</h4>
                        <ul style="list-style: none; padding: 0; margin: 0 0 1rem 0;">
                            <li>Sc&eacute;narios climatologiques par analogues Wasserstein, calibration spectrale du mod&egrave;le navire, et stabilisation des trajectoires par splines contraintes. <em>(Fran&ccedil;ais)</em></li>
                        </ul>
                        <a href="open-problems.html" class="btn btn-secondary" style="padding: 0.4rem 1rem; font-size: 0.85rem;">Read article</a>
                    </div>

                </div>
            </section>

        </div>
    </main>

</div>

<!-- Footer -->
<footer class="docs-footer">
    <div class="docs-footer-content">
        <p>&copy; 2026 WindMar. Apache License 2.0.</p>
        <p>
            <a href="https://github.com/windmar-nav/windmar">GitHub</a> &bull;
            <a href="https://slmar.co">Website</a>
        </p>
    </div>
</footer>

<!-- Sidebar active state script -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const sections = document.querySelectorAll('section[id]');
        const navLinks = document.querySelectorAll('.sidebar-menu a[href^="#"]');

        function setActiveLink() {
            let current = '';
            sections.forEach(function(section) {
                const sectionTop = section.offsetTop - 100;
                if (window.scrollY >= sectionTop) {
                    current = section.getAttribute('id');
                }
            });

            navLinks.forEach(function(link) {
                link.classList.remove('active');
                if (link.getAttribute('href') === '#' + current) {
                    link.classList.add('active');
                }
            });
        }

        window.addEventListener('scroll', setActiveLink);
        setActiveLink();
    });
</script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        renderMathInElement(document.body, {
            delimiters: [
                {left: '\\[', right: '\\]', display: true},
                {left: '\\(', right: '\\)', display: false}
            ],
            throwOnError: false
        });
    });
</script>

</body>
</html>
